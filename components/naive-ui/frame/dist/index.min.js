/*!
 * @form-create/component-naive-frame v3.1.30
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create with frame
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FcFrame={},e.Vue)}(this,(function(e,t){"use strict";function o(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function n(e){e=e||new Map;const t={$on(t,o){const n=e.get(t);n&&n.push(o)||e.set(t,[o])},$once(e,o){o._once=!0,t.$on(e,o)},$off(t,o){const n=e.get(t);n&&n.splice(n.indexOf(o)>>>0,1)},$emit(o,...n){(e.get(o)||[]).slice().map((e=>{e._once&&(t.$off(o,e),delete e._once),e(...n)})),(e.get("*")||[]).slice().map((e=>{e(o,n)}))}};return t}!function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}("._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s}._fc-frame ._fc-upload-cover ._fc-frame-icon{color:#fff;cursor:pointer;font-size:16px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .ant-upload{display:block}._fc-frame ._fc-frame-icon,._fc-frame ._fc-upload-btn{cursor:pointer}._fc-frame._fc-disabled ._fc-frame-icon,._fc-frame._fc-disabled ._fc-upload-btn{color:#999;cursor:not-allowed!important}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;border-radius:4px;box-shadow:2px 2px 5px rgba(0,0,0,.1);box-sizing:border-box;display:inline-block;height:96px;line-height:96px;margin-right:8px;overflow:hidden;position:relative;text-align:center;width:96px}._fc-frame ._fc-upload-cover .n-icon{color:#fff;cursor:pointer;font-size:20px;margin:0 2px}");var i={name:"IconFolder"};const l={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},s=[t.createElementVNode("path",{d:"M26 20h-2v4h-4v2h4v4h2v-4h4v-2h-4z",fill:"currentColor"},null,-1),t.createElementVNode("path",{d:"M28 8H16l-3.4-3.4c-.4-.4-.9-.6-1.4-.6H4c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h14v-2H4V6h7.2l3.4 3.4l.6.6H28v8h2v-8c0-1.1-.9-2-2-2z",fill:"currentColor"},null,-1)];i.render=function(e,o,n,i,r,a){return t.openBlock(),t.createElementBlock("svg",l,s)};var r=t.defineComponent({name:"IconClose",render:()=>t.h("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0},t.h("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},t.h("g",{fill:"currentColor","fill-rule":"nonzero"},t.h("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"}))))}),a=t.defineComponent({name:"IconFile",render:()=>t.h("svg",{viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},t.h("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},t.h("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),t.h("path",{d:"M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"})))});function c(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!t.isVNode(e)}var d=t.defineComponent({name:"fcFrame",props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"icon-folder"},width:{type:[Number,String],default:"500px"},height:{type:[Number,String],default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:Function,modal:{type:Object,default:()=>({})},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{IconFolder:i},data(){return{fileList:o(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new n}},watch:{modelValue(e){this.fileList=o(e)}},methods:{key:e=>e,close(){this.closeModal(!0)},closeModal(e){this.bus.$emit(e?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModal(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},input(){const e=this.fileList,t=1===this.maxLength?e[0]||"":e;this.$emit("update:modelValue",t),this.$emit("change",t)},makeInput(){const e=t.resolveComponent(this.icon),o={};return this.fileList.length&&!this.disabled&&(o.suffix=()=>t.createVNode(t.resolveComponent("n-icon"),{component:r,class:"_fc-frame-icon",onClick:()=>{this.fileList=[],this.input()}},null)),t.createVNode(t.resolveComponent("n-input-group"),null,{default:()=>[t.createVNode(t.resolveComponent("NInput"),{readonly:!0,value:this.fileList.map((e=>this.getSrc(e))).toString(),key:1},o),t.createVNode(t.resolveComponent("n-input-group-label"),{onClick:this.showModal,class:"_fc-frame-icon"},{default:()=>[t.createVNode(t.resolveComponent("n-icon"),{component:e},null)]})]})},makeGroup(e){return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),t.createVNode("div",{key:2},[e])},makeItem:(e,o)=>t.createVNode("div",{class:"_fc-files",key:"3"+e},[o]),valid(e){const t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons(e,o){if(!1!==this.handleIcon||!0===this.allowRemove){const n=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&n.push(this.makeHandleIcon(e,o)),this.allowRemove&&n.push(this.makeRemoveIcon(e,o)),t.createVNode("div",{class:"_fc-upload-cover",key:4},[n])}},makeHandleIcon(e,o){const n=t.resolveComponent(!0===this.handleIcon||void 0===this.handleIcon?"icon-eye":this.handleIcon);return t.createVNode(t.resolveComponent("n-icon"),{size:20,component:n,onClick:()=>this.handleClick(e),key:"5"+o},null)},makeRemoveIcon(e,o){return t.createVNode(t.resolveComponent("n-icon"),{size:20,component:t.resolveComponent("icon-trash"),onClick:()=>this.handleRemove(e),key:"6"+o},null)},makeFiles(){return this.makeGroup(this.fileList.map(((e,o)=>this.makeItem(o,[t.createVNode(t.resolveComponent("n-icon"),{component:a,size:20,onClick:()=>this.handleClick(e)},null),this.makeIcons(e,o)]))))},makeImages(){return this.makeGroup(this.fileList.map(((e,o)=>this.makeItem(o,[t.createVNode("img",{src:this.getSrc(e)},null),this.makeIcons(e,o)]))))},makeBtn(){const e=t.resolveComponent(this.icon);return t.createVNode("div",{class:"_fc-upload-btn",onClick:()=>this.showModal(),key:7},[t.createVNode(t.resolveComponent("n-icon"),{component:e,size:20,class:"_fc-frame-icon"},null)])},handleClick(e){if(this.onHandle)return this.onHandle(e);this.previewImage=this.getSrc(e),this.previewVisible=!0},handleRemove(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.input(),this.onRemove(e))},getSrc(e){return this.srcKey?e[this.srcKey]:e},frameLoad(e){this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModal()},set:(e,t)=>{this.valid(e),this.disabled||this.$emit("update:modelValue",t)},get:e=>(this.valid(e),this.modelValue),onOk:e=>this.bus.$on("$ok",e),onClose:e=>this.bus.$on("$close",e)})}catch(e){console.error(e)}},makeFooter(){const{okBtnText:e,closeBtnText:o,closeBtn:n,okBtn:i,footer:l}=this.$props,s=[];return l?(n&&s.push(t.createVNode(t.resolveComponent("NButton"),{onClick:()=>!1!==this.onCancel()&&this.closeModal(!0)},c(o)?o:{default:()=>[o]})),i&&s.push(t.createVNode(t.resolveComponent("NButton"),{type:"primary",onClick:()=>!1!==this.onOk()&&this.closeModal()},c(e)?e:{default:()=>[e]})),s):s}},render(){const e=this.type;let o;o="input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles();const{width:n="30%",height:i,src:l,title:s,modalTitle:r}=this.$props;return t.nextTick((()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})})),t.createVNode("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[o,t.createVNode(t.resolveComponent("nModal"),{preset:"card",mask:this.previewMask,title:r,show:this.previewVisible,style:"width: 600px;","onUpdate:show":e=>this.previewVisible=e},{default:()=>[t.createVNode("img",{style:"width: 100%",src:this.previewImage},null)]}),t.createVNode(t.resolveComponent("nModal"),t.mergeProps({preset:"dialog"},{width:n,title:s,...this.modal},{show:this.frameVisible,style:{width:n},"onUpdate:show":()=>this.closeModal(!0)}),{default:()=>[this.frameVisible||!this.reload?t.createVNode("iframe",{ref:"frame",src:l,frameborder:"0",style:{height:i,border:"0 none",width:"100%"}},null):null],action:()=>this.makeFooter()})])},beforeMount(){const{name:e,field:t,api:o}=this.formCreateInject;e&&o.on("fc:closeModal:"+e,this.close),t&&o.on("fc:closeModal:"+t,this.close)},beforeUnmount(){const{name:e,field:t,api:o}=this.formCreateInject;e&&o.off("fc:closeModal:"+e,this.close),t&&o.off("fc:closeModal:"+t,this.close)}});e.default=d,Object.defineProperty(e,"__esModule",{value:!0})}));
