/*!
 * @form-create/component-naive-upload v3.1.30
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create with upload
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FcUpload={},e.Vue)}(this,(function(e,t){"use strict";const i=function(e,t){return{url:e,name:s(e),status:"finished",id:t+1}},s=function(e){return(""+e).split("/").pop()},l=function(e){return{...e,file:e}};var r=t.defineComponent({name:"fcUpload",inheritAttrs:!1,formCreateParser:{toFormValue:e=>function(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}(e),toValue:(e,t)=>1===t.prop.props.limit?e[0]||"":e},props:{limit:{type:Number,default:0},modelValue:{type:Array,default:()=>[]},onSuccess:{type:Function,required:!0},onPreview:Function,modalTitle:String,previewMask:void 0},emits:["update:modelValue","finish","fc.el"],data(){return{previewImage:"",previewVisible:!1,uploadList:this.modelValue.map(i).map(l)}},watch:{modelValue(e){this.uploadList=e.map(i).map(l)}},methods:{handleChange({event:e,file:t}){this.$emit("finish",...arguments);const i=this.uploadList;this.onSuccess(JSON.parse(e.target.response),t),t.url&&i.push({url:t.url,file:t}),this.input(i)},input(e){this.$emit("update:modelValue",e.map((e=>e.url)))},inputRemove(e){e.length<this.uploadList.length&&this.input(e)},handlePreview(e){this.onPreview?this.onPreview(...arguments):(this.previewImage=e.url,this.previewVisible=!0)}},render(){return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("n-upload"),t.mergeProps({max:this.limit,listType:"image-card"},this.$attrs,{onPreview:this.handlePreview,onFinish:this.handleChange,key:this.uploadList.length,"default-file-list":this.uploadList,"onUpdate:fileList":this.inputRemove,ref:"el"}),this.$slots),t.createVNode(t.resolveComponent("NModal"),{preset:"card",mask:this.previewMask,title:this.modalTitle,show:this.previewVisible,style:"width: 600px;","onUpdate:show":e=>this.previewVisible=e},{default:()=>[t.createVNode("img",{style:"width: 100%",src:this.previewImage},null)]})])},mounted(){this.$emit("fc.el",this.$refs.el)}});e.default=r,Object.defineProperty(e,"__esModule",{value:!0})}));
