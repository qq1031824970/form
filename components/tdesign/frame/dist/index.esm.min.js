/*!
 * @form-create/component-tdesign-frame v3.1.30
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create with frame
 * Released under the MIT License.
 */
import{openBlock as e,createElementBlock as t,createElementVNode as i,defineComponent as o,h as n,resolveComponent as l,createVNode as s,nextTick as a,mergeProps as r,isVNode as c}from"vue";function h(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function d(e){e=e||new Map;const t={$on(t,i){const o=e.get(t);o&&o.push(i)||e.set(t,[i])},$once(e,i){i._once=!0,t.$on(e,i)},$off(t,i){const o=e.get(t);o&&o.splice(o.indexOf(i)>>>0,1)},$emit(i,...o){(e.get(i)||[]).slice().map((e=>{e._once&&(t.$off(i,e),delete e._once),e(...o)})),(e.get("*")||[]).slice().map((e=>{e(i,o)}))}};return t}!function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}("._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s}._fc-frame ._fc-upload-cover ._fc-frame-icon{color:#fff;font-size:20px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .t-upload{display:block}._fc-frame ._fc-frame-icon,._fc-frame ._fc-upload-btn{cursor:pointer;font-size:20px;width:20px}._fc-frame._fc-disabled ._fc-frame-icon,._fc-frame._fc-disabled ._fc-upload-btn{color:#999;cursor:not-allowed!important}._fc-frame .t-input-adornment__append ._fc-frame-icon{margin:5px 12px 0}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;box-shadow:2px 2px 5px rgba(0,0,0,.1);box-sizing:border-box;display:inline-block;height:112px;line-height:112px;margin-right:4px;overflow:hidden;position:relative;text-align:center;width:112px}");var f={name:"IconFolder"};const m={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},u=[i("path",{d:"M26 20h-2v4h-4v2h4v4h2v-4h4v-2h-4z",fill:"currentColor"},null,-1),i("path",{d:"M28 8H16l-3.4-3.4c-.4-.4-.9-.6-1.4-.6H4c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h14v-2H4V6h7.2l3.4 3.4l.6.6H28v8h2v-8c0-1.1-.9-2-2-2z",fill:"currentColor"},null,-1)];f.render=function(i,o,n,l,s,a){return e(),t("svg",m,u)};var p=o({name:"IconFile",render:()=>n("svg",{style:{width:"20px",fontSize:"20px"},viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},n("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},n("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),n("path",{d:"M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"})))}),v={name:"DeleteOutlined"};const g={height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},y=[i("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z",fill:"currentColor"},null,-1)];v.render=function(i,o,n,l,s,a){return e(),t("svg",g,y)};var b={name:"EyeOutlined"};const k={height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},w=[i("path",{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 0 0 0 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3c7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176s176-78.8 176-176s-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112s112 50.1 112 112s-50.1 112-112 112z",fill:"currentColor"},null,-1)];function x(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!c(e)}b.render=function(i,o,n,l,s,a){return e(),t("svg",k,w)};var _=o({name:"fcFrame",props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"icon-folder"},width:{type:[Number,String],default:"500px"},height:{type:[Number,String],default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:Function,modal:{type:Object,default:()=>({})},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{IconFolder:f,EyeOutlined:b},data(){return{fileList:h(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new d}},watch:{modelValue(e){this.fileList=h(e)}},methods:{key:e=>e,close(){this.closeModal(!0)},closeModal(e){this.bus.$emit(e?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModal(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},input(){const e=this.fileList,t=1===this.maxLength?e[0]||"":e;this.$emit("update:modelValue",t),this.$emit("change",t)},makeInput(){const e=l(this.icon);return s(l("t-input-adornment"),{append:()=>s(e,{onClick:this.showModal,class:"_fc-frame-icon"},null)},{default:()=>[s(l("TInput"),{readonly:!0,clearable:!this.disabled,showClearIconOnEmpty:!this.disabled,value:this.fileList.map((e=>this.getSrc(e))).toString(),onClear:()=>{this.fileList=[],this.input()},key:1},null)]})},makeGroup(e){return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),s("div",{key:2},[e])},makeItem:(e,t)=>s("div",{class:"_fc-files",key:"3"+e},[t]),valid(e){const t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons(e,t){if(!1!==this.handleIcon||!0===this.allowRemove){const i=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&i.push(this.makeHandleIcon(e,t)),this.allowRemove&&i.push(this.makeRemoveIcon(e,t)),s("div",{class:"_fc-upload-cover",key:4},[i])}},makeHandleIcon(e,t){const i=l(!0===this.handleIcon||void 0===this.handleIcon?"EyeOutlined":this.handleIcon);return s(i,{class:"_fc-frame-icon",onClick:()=>this.handleClick(e),key:"5"+t},null)},makeRemoveIcon(e,t){return s(v,{class:"_fc-frame-icon",onClick:()=>this.handleRemove(e),key:"6"+t},null)},makeFiles(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[s(p,{size:"20",onClick:()=>this.handleClick(e)},null),this.makeIcons(e,t)]))))},makeImages(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[s("img",{src:this.getSrc(e)},null),this.makeIcons(e,t)]))))},makeBtn(){const e=l(this.icon);return s("div",{class:"_fc-upload-btn",onClick:()=>this.showModal(),key:7},[s(e,{class:"_fc-frame-icon"},null)])},handleClick(e){if(this.onHandle)return this.onHandle(e);this.previewImage=this.getSrc(e),this.previewVisible=!0},handleRemove(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.input(),this.onRemove(e))},getSrc(e){return this.srcKey?e[this.srcKey]:e},frameLoad(e){this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModal()},set:(e,t)=>{this.valid(e),this.disabled||(this.$emit("update:modelValue",t),this.$emit("change",t))},get:e=>(this.valid(e),this.modelValue),onOk:e=>this.bus.$on("$ok",e),onClose:e=>this.bus.$on("$close",e)})}catch(e){console.error(e)}},makeFooter(){const{okBtnText:e,closeBtnText:t,closeBtn:i,okBtn:o,footer:n}=this.$props,a=[];return n?(i&&a.push(s(l("TButton"),{onClick:()=>!1!==this.onCancel()&&this.closeModal(!0)},x(t)?t:{default:()=>[t]})),o&&a.push(s(l("TButton"),{theme:"primary",onClick:()=>!1!==this.onOk()&&this.closeModal()},x(e)?e:{default:()=>[e]})),a):a}},render(){const e=this.type;let t;t="input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles();const{width:i="30%",height:o,src:n,title:c,modalTitle:h}=this.$props;return a((()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})})),s("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[t,s(l("TDialog"),{mask:this.previewMask,header:h,visible:this.previewVisible,style:"width: 600px;",attach:"body","onUpdate:visible":e=>this.previewVisible=e,footer:!1},{default:()=>[s("img",{style:"width: 100%",src:this.previewImage,key:1},null)]}),s(l("TDialog"),r({width:i,header:c,...this.modal},{visible:this.frameVisible,attach:"body",style:{width:i},onClose:()=>this.frameVisible=!1,onConfirm:()=>this.closeModal(!0),key:2}),{default:()=>[this.frameVisible||!this.reload?s("iframe",{ref:"frame",src:n,frameborder:"0",style:{height:o,border:"0 none",width:"100%"}},null):null],action:()=>this.makeFooter()})])},beforeMount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.on("fc:closeModal:"+e,this.close),t&&i.on("fc:closeModal:"+t,this.close)},beforeUnmount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.off("fc:closeModal:"+e,this.close),t&&i.off("fc:closeModal:"+t,this.close)}});export{_ as default};
