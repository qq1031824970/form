/*!
 * @form-create/component-arco-frame v3.1.30
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create with frame
 * Released under the MIT License.
 */
import{openBlock as e,createElementBlock as t,createElementVNode as o,defineComponent as i,resolveComponent as n,createVNode as l,nextTick as s,mergeProps as a,isVNode as r}from"vue";function c(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function h(e){e=e||new Map;const t={$on(t,o){const i=e.get(t);i&&i.push(o)||e.set(t,[o])},$once(e,o){o._once=!0,t.$on(e,o)},$off(t,o){const i=e.get(t);i&&i.splice(i.indexOf(o)>>>0,1)},$emit(o,...i){(e.get(o)||[]).slice().map((e=>{e._once&&(t.$off(o,e),delete e._once),e(...i)})),(e.get("*")||[]).slice().map((e=>{e(o,i)}))}};return t}!function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===o&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}("._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s}._fc-frame ._fc-upload-cover ._fc-frame-icon{color:#fff;font-size:16px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .ant-upload{display:block}._fc-frame ._fc-frame-icon,._fc-frame ._fc-upload-btn{cursor:pointer}._fc-frame._fc-disabled ._fc-frame-icon,._fc-frame._fc-disabled ._fc-upload-btn{color:#999;cursor:not-allowed!important}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;border-radius:4px;box-shadow:2px 2px 5px rgba(0,0,0,.1);box-sizing:border-box;display:inline-block;height:80px;line-height:80px;margin-right:8px;overflow:hidden;position:relative;text-align:center;width:80px}._fc-frame ._fc-upload-cover svg{color:#fff;cursor:pointer;font-size:20px;margin:0 2px}");var d={name:"IconFolder"};const f={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-folder","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},m=[o("path",{d:"M6 13h18l-2.527-3.557a1.077 1.077 0 0 0-.88-.443H7.06C6.474 9 6 9.448 6 10v3Zm0 0h33.882c1.17 0 2.118.895 2.118 2v21c0 1.105-.948 3-2.118 3H8.118C6.948 39 6 38.105 6 37V13Z"},null,-1)];d.render=function(o,i,n,l,s,a){return e(),t("svg",f,m)};var u={name:"IconDelete"};const p={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-delete","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},k=[o("path",{d:"M5 11h5.5m0 0v29a1 1 0 0 0 1 1h25a1 1 0 0 0 1-1V11m-27 0H16m21.5 0H43m-5.5 0H32m-16 0V7h16v4m-16 0h16M20 18v15m8-15v15"},null,-1)];u.render=function(o,i,n,l,s,a){return e(),t("svg",p,k)};var v={name:"IconCloseCircle"};const g={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-close-circle","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},b=[o("path",{d:"m17.643 17.643 6.364 6.364m0 0 6.364 6.364m-6.364-6.364 6.364-6.364m-6.364 6.364-6.364 6.364M42 24c0 9.941-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6s18 8.059 18 18Z"},null,-1)];v.render=function(o,i,n,l,s,a){return e(),t("svg",g,b)};var y={name:"IconEye"};const w={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-eye","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},x=[o("path",{"clip-rule":"evenodd",d:"M24 37c6.627 0 12.627-4.333 18-13-5.373-8.667-11.373-13-18-13-6.627 0-12.627 4.333-18 13 5.373 8.667 11.373 13 18 13Z"},null,-1),o("path",{d:"M29 24a5 5 0 1 1-10 0 5 5 0 0 1 10 0Z"},null,-1)];y.render=function(o,i,n,l,s,a){return e(),t("svg",w,x)};var _={name:"IconFile"};const I={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-file","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},C=[o("path",{d:"M16 21h16m-16 8h10m11 13H11a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h21l7 7v27a2 2 0 0 1-2 2Z"},null,-1)];function B(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!r(e)}_.render=function(o,i,n,l,s,a){return e(),t("svg",I,C)};var M=i({name:"fcFrame",props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"icon-folder"},width:{type:[Number,String],default:500},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:Function,modal:{type:Object,default:()=>({})},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{IconFolder:d,IconEye:y},data(){return{fileList:c(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new h}},watch:{modelValue(e){this.fileList=c(e)}},methods:{close(){this.closeModal(!0)},closeModal(e){this.bus.$emit(e?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModal(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},input(){const e=this.fileList,t=1===this.maxLength?e[0]||"":e;this.$emit("update:modelValue",t),this.$emit("change",t)},makeInput(){const e=n(this.icon),t={append:()=>l(e,{class:"_fc-frame-icon",onClick:this.showModal},null)};return this.fileList.length&&!this.disabled&&(t.suffix=()=>l(v,{class:"_fc-frame-icon",onClick:()=>{this.fileList=[],this.input()}},null)),l(n("AInput"),{readonly:!0,modelValue:this.fileList.map((e=>this.getSrc(e))).toString(),key:1},t)},makeGroup(e){return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),l("div",{key:2},[e])},makeItem:(e,t)=>l("div",{class:"_fc-files",key:"3"+e},[t]),valid(e){const t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons(e,t){if(!1!==this.handleIcon||!0===this.allowRemove){const o=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&o.push(this.makeHandleIcon(e,t)),this.allowRemove&&o.push(this.makeRemoveIcon(e,t)),l("div",{class:"_fc-upload-cover",key:4},[o])}},makeHandleIcon(e,t){const o=n(!0===this.handleIcon||void 0===this.handleIcon?"icon-eye":this.handleIcon);return l(o,{onClick:()=>this.handleClick(e),key:"5"+t},null)},makeRemoveIcon(e,t){return l(u,{onClick:()=>this.handleRemove(e),key:"6"+t},null)},makeFiles(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[l(_,{onClick:()=>this.handleClick(e)},null),this.makeIcons(e,t)]))))},makeImages(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[l("img",{src:this.getSrc(e)},null),this.makeIcons(e,t)]))))},makeBtn(){const e=n(this.icon);return l("div",{class:"_fc-upload-btn",onClick:()=>this.showModal(),key:7},[l(e,{class:"_fc-frame-icon"},null)])},handleClick(e){if(this.onHandle)return this.onHandle(e);this.previewImage=this.getSrc(e),this.previewVisible=!0},handleRemove(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.input(),this.onRemove(e))},getSrc(e){return this.srcKey?e[this.srcKey]:e},frameLoad(e){this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModal()},set:(e,t)=>{this.valid(e),this.disabled||this.$emit("update:modelValue",t)},get:e=>(this.valid(e),this.modelValue),onOk:e=>this.bus.$on("$ok",e),onClose:e=>this.bus.$on("$close",e)})}catch(e){console.error(e)}},makeFooter(){const{okBtnText:e,closeBtnText:t,closeBtn:o,okBtn:i,footer:s}=this.$props,a=[];return s?(o&&a.push(l(n("AButton"),{onClick:()=>!1!==this.onCancel()&&this.closeModal(!0)},B(t)?t:{default:()=>[t]})),i&&a.push(l(n("AButton"),{type:"primary",onClick:()=>!1!==this.onOk()&&this.closeModal()},B(e)?e:{default:()=>[e]})),a):a}},render(){const e=this.type;let t;t="input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles();const{width:o="30%",height:i,src:r,title:c,modalTitle:h}=this.$props;return s((()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})})),l("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[t,l(n("aModal"),{mask:this.previewMask,title:h,visible:this.previewVisible,onCancel:()=>this.previewVisible=!1,footer:null},{default:()=>[l("img",{style:"width: 100%",src:this.previewImage},null)]}),l(n("aModal"),a({width:o,title:c,...this.modal},{visible:this.frameVisible,onCancel:()=>this.closeModal(!0)}),{default:()=>[this.frameVisible||!this.reload?l("iframe",{ref:"frame",src:r,frameborder:"0",style:{height:i,border:"0 none",width:"100%"}},null):null],footer:()=>this.makeFooter()})])},beforeMount(){const{name:e,field:t,api:o}=this.formCreateInject;e&&o.on("fc:closeModal:"+e,this.close),t&&o.on("fc:closeModal:"+t,this.close)},beforeUnmount(){const{name:e,field:t,api:o}=this.formCreateInject;e&&o.off("fc:closeModal:"+e,this.close),t&&o.off("fc:closeModal:"+t,this.close)}});export{M as default};
