/*!
 * @form-create/ant-design-vue v3.1.32
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
import{openBlock as e,createElementBlock as t,createElementVNode as i,defineComponent as r,resolveComponent as n,createVNode as s,Fragment as o,mergeProps as a,nextTick as l,isVNode as c,markRaw as u,watch as d,reactive as h,getCurrentInstance as p,provide as f,inject as m,toRefs as g,onBeforeMount as y,onMounted as v,onBeforeUnmount as b,onUpdated as x,computed as _,toRef as w,withDirectives as C,resolveDirective as $,ref as k,createApp as O,h as S}from"vue";function F(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}var R={name:"PlusOutlined"};const E={class:"anticon"},V=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("defs"),i("path",{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z",fill:"currentColor"}),i("path",{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z",fill:"currentColor"})],-1)];R.render=function(i,r,n,s,o,a){return e(),t("span",E,V)};const j=function(e,t){return{url:e,name:P(e),status:"done",uid:-1*(t+1)}},P=function(e){return(""+e).split("/").pop()},A=function(e){return{url:e.url,file:e,uid:e.uid}};var I=r({name:"fcUpload",inheritAttrs:!1,formCreateParser:{toFormValue:e=>F(e),toValue:(e,t)=>1===t.prop.props.limit?e[0]||"":e},props:{limit:{type:Number,default:0},modelValue:{type:Array,default:()=>[]},onSuccess:{type:Function,required:!0},onPreview:Function,modalTitle:String,previewMask:void 0},emits:["update:modelValue","change","fc.el"],data(){return{previewImage:"",previewVisible:!1,uploadList:this.modelValue.map(j).map(A)}},watch:{modelValue(e){this.uploadList=e.map(j).map(A)}},methods:{handlePreview(e){this.onPreview?this.onPreview(...arguments):(this.previewImage=e.url,this.previewVisible=!0)},handleChange({file:e,fileList:t}){this.$emit("change",...arguments),this.uploadList=t,"done"===e.status?(this.onSuccess(e,t),this.input()):"removed"===e.status&&(t.forEach(((i,r)=>{i.file===e&&t.splice(r,1)})),this.input())},input(){this.$emit("update:modelValue",this.uploadList.map((e=>e.url)))}},render(){var e,t;const i=!this.limit||this.limit>this.uploadList.length,r=n("AModal"),l={[r.props.open?"open":"visible"]:this.previewVisible};return s(o,null,[s(n("AUpload"),a({maxCount:this.limit,"list-type":"picture-card"},this.$attrs,{onPreview:this.handlePreview,onChange:this.handleChange,fileList:this.uploadList,ref:"upload"}),{default:()=>[i?(null===(e=(t=this.$slots).default)||void 0===e?void 0:e.call(t))||s(R,{style:"font-size: 16px; width: 16px;"},null):null],...(c=this.$slots,u=["default"],Object.keys(c).reduce(((e,t)=>(u&&-1!==u.indexOf(t)||e.push(c[t]),e)),[]))}),s(r,a({mask:this.previewMask,title:this.modalTitle},l,{onCancel:()=>this.previewVisible=!1,footer:null}),{default:()=>[s("img",{style:"width: 100%",src:this.previewImage},null)]})]);var c,u},mounted(){this.$emit("fc.el",this.$refs.upload)}});function B(e){e=e||new Map;const t={$on(t,i){const r=e.get(t);r&&r.push(i)||e.set(t,[i])},$once(e,i){i._once=!0,t.$on(e,i)},$off(t,i){const r=e.get(t);r&&r.splice(r.indexOf(i)>>>0,1)},$emit(i,...r){(e.get(i)||[]).slice().map((e=>{e._once&&(t.$off(i,e),delete e._once),e(...r)})),(e.get("*")||[]).slice().map((e=>{e(i,r)}))}};return t}var D={name:"CloseCircleOutlined"};const T={class:"anticon"},N=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4l-66.1-.3c-4.4 0-8 3.5-8 8c0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670a8.32 8.32 0 0 0-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4l66 .3c4.4 0 8-3.5 8-8c0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z",fill:"currentColor"}),i("path",{d:"M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448s448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"})],-1)];D.render=function(i,r,n,s,o,a){return e(),t("span",T,N)};var L={name:"FolderOutlined"};const M={class:"anticon"},U=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 0 0-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z",fill:"currentColor"})],-1)];L.render=function(i,r,n,s,o,a){return e(),t("span",M,U)};var q={name:"FileOutlined"};const H={class:"anticon"},z=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0 0 42 42h216v494z",fill:"currentColor"})],-1)];q.render=function(i,r,n,s,o,a){return e(),t("span",H,z)};var G={name:"DeleteOutlined"};const J={class:"anticon"},Y=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z",fill:"currentColor"})],-1)];G.render=function(i,r,n,s,o,a){return e(),t("span",J,Y)};var W={name:"EyeOutlined"};const K={class:"anticon"},Q=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 0 0 0 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3c7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176s176-78.8 176-176s-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112s112 50.1 112 112s-50.1 112-112 112z",fill:"currentColor"})],-1)];function X(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}W.render=function(i,r,n,s,o,a){return e(),t("span",K,Q)};function Z(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!c(e)}X("._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s}._fc-frame ._fc-upload-cover ._fc-frame-icon{color:#fff;font-size:16px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .anticon{font-size:16px;width:16px}._fc-frame .ant-upload{display:block}._fc-frame ._fc-frame-icon,._fc-frame ._fc-upload-btn{cursor:pointer}._fc-frame._fc-disabled ._fc-frame-icon,._fc-frame._fc-disabled ._fc-upload-btn{color:#999;cursor:not-allowed!important}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;border-radius:4px;box-shadow:2px 2px 5px rgba(0,0,0,.1);box-sizing:border-box;display:inline-block;height:104px;line-height:104px;margin-right:4px;overflow:hidden;position:relative;text-align:center;width:104px}");var ee=r({name:"fcFrame",props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"FolderOutlined"},width:{type:[Number,String],default:500},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:Function,modal:{type:Object,default:()=>({})},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{FolderOutlined:L,EyeOutlined:W},data(){return{fileList:F(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new B}},watch:{modelValue(e){this.fileList=F(e)}},methods:{close(){this.closeModal(!0)},closeModal(e){this.bus.$emit(e?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModal(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},input(){const e=this.fileList,t=1===this.maxLength?e[0]||"":e;this.$emit("update:modelValue",t),this.$emit("change",t)},makeInput(){const e=n(this.icon),t={addonAfter:()=>s(e,{class:"_fc-frame-icon",onClick:this.showModal},null)};return this.fileList.length&&!this.disabled&&(t.suffix=()=>s(D,{class:"_fc-frame-icon",onClick:()=>{this.fileList=[],this.input()}},null)),s(n("AInput"),{readonly:!0,value:this.fileList.map((e=>this.getSrc(e))).toString(),key:1},t)},makeGroup(e){return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),s("div",{key:2},[e])},makeItem:(e,t)=>s("div",{class:"_fc-files",key:"3"+e},[t]),valid(e){const t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons(e,t){if(!1!==this.handleIcon||!0===this.allowRemove){const i=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&i.push(this.makeHandleIcon(e,t)),this.allowRemove&&i.push(this.makeRemoveIcon(e,t)),s("div",{class:"_fc-upload-cover",key:4},[i])}},makeHandleIcon(e,t){const i=n(!0===this.handleIcon||void 0===this.handleIcon?"EyeOutlined":this.handleIcon);return s(i,{class:"_fc-frame-icon",onClick:()=>this.handleClick(e),key:"5"+t},null)},makeRemoveIcon(e,t){return s(G,{class:"_fc-frame-icon",onClick:()=>this.handleRemove(e),key:"6"+t},null)},makeFiles(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[s(q,{class:"_fc-frame-icon",onClick:()=>this.handleClick(e)},null),this.makeIcons(e,t)]))))},makeImages(){return this.makeGroup(this.fileList.map(((e,t)=>this.makeItem(t,[s("img",{src:this.getSrc(e)},null),this.makeIcons(e,t)]))))},makeBtn(){const e=n(this.icon);return s("div",{class:"_fc-upload-btn",onClick:()=>this.showModal(),key:7},[s(e,{class:"_fc-frame-icon"},null)])},handleClick(e){if(this.onHandle)return this.onHandle(e);this.previewImage=this.getSrc(e),this.previewVisible=!0},handleRemove(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.input(),this.onRemove(e))},getSrc(e){return this.srcKey?e[this.srcKey]:e},frameLoad(e){this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModal()},set:(e,t)=>{this.valid(e),this.disabled||this.$emit("update:modelValue",t)},get:e=>(this.valid(e),this.modelValue),onOk:e=>this.bus.$on("$ok",e),onClose:e=>this.bus.$on("$close",e)})}catch(e){console.error(e)}},makeFooter(){const{okBtnText:e,closeBtnText:t,closeBtn:i,okBtn:r,footer:o}=this.$props,a=[];return o?(i&&a.push(s(n("AButton"),{onClick:()=>!1!==this.onCancel()&&this.closeModal(!0)},Z(t)?t:{default:()=>[t]})),r&&a.push(s(n("AButton"),{type:"primary",onClick:()=>!1!==this.onOk()&&this.closeModal()},Z(e)?e:{default:()=>[e]})),a):a}},render(){const e=this.type;let t;t="input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles();const{width:i="30%",height:r,src:o,title:c,modalTitle:u}=this.$props;l((()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})}));const d=n("AModal");return s("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[t,s(d,a({mask:this.previewMask,title:u},{[d&&d.props.open?"open":"visible"]:this.previewVisible},{onCancel:()=>this.previewVisible=!1,footer:null}),{default:()=>[s("img",{style:"width: 100%",src:this.previewImage},null)]}),s(d,a({width:i,title:c,...this.modal},{[d&&d.props.open?"open":"visible"]:this.frameVisible},{onCancel:()=>this.closeModal(!0)}),{default:()=>[this.frameVisible||!this.reload?s("iframe",{ref:"frame",src:o,frameborder:"0",style:{height:r,border:"0 none",width:"100%"}},null):null],footer:()=>this.makeFooter()})])},beforeMount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.on("fc:closeModal:"+e,this.close),t&&i.on("fc:closeModal:"+t,this.close)},beforeUnmount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.off("fc:closeModal:"+e,this.close),t&&i.off("fc:closeModal:"+t,this.close)}});const te={type:(e,t)=>Object.prototype.toString.call(e)==="[object "+t+"]",Undef:e=>null==e,Element:e=>"object"==typeof e&&null!==e&&1===e.nodeType&&!te.Object(e),trueArray:e=>Array.isArray(e)&&e.length>0,Function(e){const t=this.getType(e);return"Function"===t||"AsyncFunction"===t},getType(e){const t=Object.prototype.toString.call(e);return/^\[object (.*)\]$/.exec(t)[1]},empty:e=>null==e||(!(!Array.isArray(e)||!Array.isArray(e)||e.length)||"string"==typeof e&&!e)};function ie(e,t){return{}.hasOwnProperty.call(e,t)}function re(e,t,i){e[t]=i}function ne(e,t){delete e[t]}function se(e,t={},i){let r=!1;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let s=t[n];if((r=Array.isArray(s))||te.Object(s)){let t=void 0===e[n];if(r)r=!1,t&&re(e,n,[]);else if(s._clone&&void 0!==i){if(!i){re(e,n,s._clone());continue}s=s.getRule(),t&&re(e,n,{})}else t&&re(e,n,{});e[n]=se(e[n],s,i)}else re(e,n,s),te.Undef(s)||(te.Undef(s.__json)||(e[n].__json=s.__json),te.Undef(s.__origin)||(e[n].__origin=s.__origin))}return void 0!==i&&Array.isArray(e)?e.filter((e=>!e||!e.__ctrl)):e}function oe(e){return se({},{value:e}).value}["Date","Object","String","Boolean","Array","Number"].forEach((e=>{te[e]=function(t){return te.type(t,e)}}));const ae=Object.assign||function(e){for(let t,i=1;i<arguments.length;i++)for(let r in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,r)&&re(e,r,t[r]);return e};function le(){return ae.apply(this,arguments)}function ce(e){return"object"!=typeof e||null===e?e:e instanceof Array?[...e]:{...e}}X('._fc-group{display:flex;flex-direction:column;justify-content:center;min-height:38px;width:100%}._fc-group-disabled ._fc-group-add,._fc-group-disabled ._fc-group-btn{cursor:not-allowed}._fc-group-handle{background-color:#fff;border:1px dashed #d9d9d9;border-radius:15px;bottom:-15px;display:flex;flex-direction:row;padding:3px 8px;position:absolute;right:30px}._fc-group-btn{cursor:pointer}._fc-group-idx{align-items:center;background:#eee;border-radius:15px;bottom:-15px;display:flex;font-weight:700;height:30px;justify-content:center;left:10px;position:absolute;width:30px}._fc-group-handle ._fc-group-btn+._fc-group-btn{margin-left:7px}._fc-group-container{border:1px dashed #d9d9d9;border-radius:5px;display:flex;flex-direction:column;margin:5px 5px 25px;padding:20px 20px 25px;position:relative}._fc-group-arrow{height:20px;position:relative;width:20px}._fc-group-arrow:before{border-left:2px solid #999;border-top:2px solid #999;content:"";height:9px;left:5px;position:absolute;top:8px;transform:rotate(45deg);width:9px}._fc-group-arrow._fc-group-down{transform:rotate(180deg)}._fc-group-plus-minus{cursor:pointer;height:20px;position:relative;width:20px}._fc-group-plus-minus:after,._fc-group-plus-minus:before{background-color:#409eff;content:"";height:2px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:60%}._fc-group-plus-minus:before{transform:translate(-50%,-50%) rotate(90deg)}._fc-group-plus-minus._fc-group-minus:before{display:none}._fc-group-plus-minus._fc-group-minus:after{background-color:#f56c6c}._fc-group-add{border:1px solid rgba(64,158,255,.5);border-radius:15px;cursor:pointer;height:25px;width:25px}._fc-group-add._fc-group-plus-minus:after,._fc-group-add._fc-group-plus-minus:before{width:50%}');var ue=r({name:"fcGroup",props:{field:String,rule:Array,expand:Number,options:Object,button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},modelValue:{type:Array,default:()=>[]},defaultValue:Object,sortBtn:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},onBeforeRemove:{type:Function,default:()=>{}},onBeforeAdd:{type:Function,default:()=>{}},formCreateInject:Object,parse:Function},data(){return{len:0,cacheRule:{},cacheValue:{},sort:[],form:u(this.formCreateInject.form.$form())}},emits:["update:modelValue","change","itemMounted","remove","add"],watch:{rule:{handler(e,t){Object.keys(this.cacheRule).forEach((i=>{const r=this.cacheRule[i];if(r.$f){const i=r.$f.formData();if(e===t)r.$f.deferSyncValue((()=>{se(r.rule,e),r.$f.setValue(i)}),!0);else{const t=r.$f.formData();r.$f.once("reloading",(()=>{r.$f.setValue(t)})),r.rule=oe(e)}}}))},deep:!0},disabled(e){if(this.syncDisabled){const t=this.cacheRule;Object.keys(t).forEach((i=>{t[i].$f.disabled(e)}))}},expand(e){let t=e-this.modelValue.length;t>0&&this.expandRule(t)},modelValue:{handler(e){e=e||[];let t=Object.keys(this.sort),i=t.length,r=i-e.length;if(r<0){for(let t=r;t<0;t++)this.addRule(e.length+t,!0);for(let r=0;r<i;r++)this.setValue(t[r],e[r])}else{if(r>0)for(let e=0;e<r;e++)this.removeRule(t[i-e-1]);e.forEach(((i,r)=>{this.setValue(t[r],e[r])}))}},deep:!0}},methods:{_value(e){return e&&ie(e,this.field)?e[this.field]:e},cache(e,t){this.cacheValue[e]=JSON.stringify(t)},input(e){this.$emit("update:modelValue",e),this.$emit("change",e)},formData(e,t){const i=this.cacheRule,r=this.sort;if(r.filter((e=>i[e].$f)).length!==r.length)return;const n=r.map((i=>{const r=e===i?t:{...this.cacheRule[i].$f.form},n=this.field?r[this.field]||null:r;return this.cache(i,n),n}));this.input(n)},setValue(e,t){const i=this.field;i&&(t={[i]:this._value(t)}),this.cacheValue[e]!==JSON.stringify(i?t[i]:t)&&this.cache(e,t)},addRule(e,t){const i=this.formCreateInject.form.copyRules(this.rule||[]),r=this.options?{...this.options}:{submitBtn:!1,resetBtn:!1};if(this.defaultValue){r.formData||(r.formData={});const e=oe(this.defaultValue);le(r.formData,this.field?{[this.field]:e}:e)}this.parse&&this.parse({rule:i,options:r,index:this.sort.length}),this.cacheRule[++this.len]={rule:i,options:r},t&&l((()=>this.$emit("add",i,Object.keys(this.cacheRule).length-1)))},add$f(e,t,i){this.cacheRule[t].$f=i,l((()=>{this.syncDisabled&&i.disabled(this.disabled),this.$emit("itemMounted",i,Object.keys(this.cacheRule).indexOf(t))}))},removeRule(e,t){const i=Object.keys(this.cacheRule).indexOf(e);delete this.cacheRule[e],delete this.cacheValue[e],t&&l((()=>this.$emit("remove",i)))},add(e){if(this.disabled||!1===this.onBeforeAdd(this.modelValue))return;const t=[...this.modelValue];t.push(this.defaultValue?oe(this.defaultValue):this.field?null:{}),this.input(t)},del(e,t){if(this.disabled||!1===this.onBeforeRemove(this.modelValue,e))return;this.removeRule(t,!0);const i=[...this.modelValue];i.splice(e,1),this.input(i)},addIcon(e){return s("div",{class:"_fc-group-btn _fc-group-plus-minus",onClick:this.add},null)},delIcon(e,t){return s("div",{class:"_fc-group-btn _fc-group-plus-minus _fc-group-minus",onClick:()=>this.del(e,t)},null)},sortUpIcon(e){return s("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-up",onClick:()=>this.changeSort(e,-1)},null)},sortDownIcon(e){return s("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-down",onClick:()=>this.changeSort(e,1)},null)},changeSort(e,t){const i=this.sort[e];this.sort[e]=this.sort[e+t],this.sort[e+t]=i,this.formData(0)},makeIcon(e,t,i){if(this.$slots.button)return this.$slots.button({total:e,index:t,vm:this,key:i,del:()=>this.del(t,i),add:this.add});const r=[];return(!this.max||e<this.max)&&e===t+1&&r.push(this.addIcon(i)),e>this.min&&r.push(this.delIcon(t,i)),this.sortBtn&&t&&r.push(this.sortUpIcon(t)),this.sortBtn&&t!==e-1&&r.push(this.sortDownIcon(t)),r},emitEvent(e,t,i,r){this.$emit(e,...t,this.cacheRule[r].$f,i)},expandRule(e){for(let t=0;t<e;t++)this.addRule(t)}},created(){d((()=>({...this.cacheRule})),(e=>{this.sort=Object.keys(e)}),{immediate:!0});const e=(this.expand||0)-this.modelValue.length;for(let e=0;e<this.modelValue.length;e++)this.addRule(e);e>0&&this.expandRule(e)},render(){const e=this.sort,t=this.button,i=this.form,r=this.disabled,n=0===e.length?this.$slots.default?this.$slots.default({vm:this,add:this.add}):s("div",{key:"a_def",class:"_fc-group-plus-minus _fc-group-add fc-clock",onClick:this.add},null):e.map(((n,o)=>{const{rule:l,options:c}=this.cacheRule[n],u=t&&!r?this.makeIcon(e.length,o,n):[];return s("div",{class:"_fc-group-container",key:n},[s(i,a({key:n},{"onUpdate:modelValue":e=>this.formData(n,e),"onEmit-event":(e,...t)=>this.emitEvent(e,t,o,n),"onUpdate:api":e=>this.add$f(o,n,e),inFor:!0,modelValue:this.field?{[this.field]:this._value(this.modelValue[o])}:this.modelValue[o],rule:l,option:c,extendOption:!0}),null),s("div",{class:"_fc-group-idx"},[o+1]),u.length?s("div",{class:"_fc-group-handle fc-clock"},[u]):null])}));return s("div",{key:"con",class:"_fc-group "+(r?"_fc-group-disabled":"")},[n])}});var de=r({name:"fcSubForm",props:{rule:Array,options:{type:Object,default:()=>h({submitBtn:!1,resetBtn:!1})},modelValue:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},formCreateInject:Object},data(){return{cacheValue:{},subApi:{},form:u(this.formCreateInject.form.$form())}},emits:["fc:subform","update:modelValue","change","itemMounted"],watch:{disabled(e){this.syncDisabled&&this.subApi.disabled(e)},modelValue(e){this.setValue(e)}},methods:{formData(e){this.cacheValue=JSON.stringify(e),this.$emit("update:modelValue",e),this.$emit("change",e)},setValue(e){const t=JSON.stringify(e);this.cacheValue!==t&&(this.cacheValue=t,this.subApi.coverValue(e||{}))},add$f(e){this.subApi=e,l((()=>{this.syncDisabled&&e.disabled(this.disabled),this.$emit("itemMounted",e)}))}},render(){const e=this.form;return s(e,{"onUpdate:modelValue":this.formData,modelValue:this.modelValue,"onEmit-event":this.$emit,"onUpdate:api":this.add$f,rule:this.rule,option:this.options,extendOption:!0},null)}}),he={name:"QuestionCircleOutlined"};const pe={class:"anticon"},fe=[i("svg",{height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[i("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"}),i("path",{d:"M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7c-21.2 8.1-39.2 22.3-52.1 40.9c-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0 1 30.9-44.8c59-22.7 97.1-74.7 97.1-132.5c.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1 0 80 0a40 40 0 1 0-80 0z",fill:"currentColor"})],-1)];he.render=function(i,r,n,s,o,a){return e(),t("span",pe,fe)};var me=[I,ee,ue,de,he],ge={name:"checkbox",modelField:"value",mergeProp(e){const t=e.prop.props;ie(t,"options")||(t.options=e.prop.options||[])}},ye={...ge,name:"radio"},ve={...ge,name:"select"};function be(e){let t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}function xe(e,t,i){return`[form-create ${e}]: ${t}`+(i?"\n\nrule: "+JSON.stringify(i.getRule?i.getRule():i):"")}function _e(e,t){console.error(xe("err",e,t))}const we="[[FORM-CREATE-PREFIX-",Ce="-FORM-CREATE-SUFFIX]]",$e="$FN:",ke="$FNX:",Oe="$GLOBAL:",Se="function";function Fe(e,t){return JSON.stringify(se(Array.isArray(e)?[]:{},e,!0),(function(e,t){if(!t||!0!==t._isVue){if(typeof t!==Se)return t;if(t.__json)return t.__json;if(t.__origin&&(t=t.__origin),!t.__emit)return we+t+Ce}}),t)}function Re(e){return new Function("return "+e)()}function Ee(e,t){if(e&&te.String(e)&&e.length>4){let i=e.trim(),r=!1;try{if(i.indexOf(Ce)>0&&0===i.indexOf(we))i=i.replace(Ce,"").replace(we,""),r=!0;else if(0===i.indexOf($e))i=i.replace($e,""),r=!0;else{if(0===i.indexOf(Oe)){const t=i.replace(Oe,"");return i=function(...e){const i=e[0].api.getGlobalEvent(t);if(i)return i.call(this,...e)},i.__json=e,i.__inject=!0,i}if(0===i.indexOf(ke))return i=Re("function($inject){"+i.replace(ke,"")+"}"),i.__json=e,i.__inject=!0,i;t||0!==i.indexOf(Se)||i===Se||(r=!0)}if(!r)return e;const n=Re(-1===i.indexOf(Se)&&0!==i.indexOf("(")?Se+" "+i:i);return n.__json=e,n}catch(e){return void _e(`解析失败:${i}\n\nerr: ${e}`)}}return e}function Ve(e,t){return JSON.parse(e,(function(e,i){return te.Undef(i)||!i.indexOf?i:Ee(i,t)}))}let je=0;function Pe(){const e=370+ ++je;return"F"+Math.random().toString(36).substr(3,3)+Number(`${Date.now()}`).toString(36)+e.toString(36)+"c"}function Ae(e,t,i){let r,n=e;return(t||"").split(".").forEach((e=>{r&&(n[r]&&"object"==typeof n[r]||(n[r]={}),n=n[r]),r=e})),n[r]=i,n}const Ie="FormCreate",Be=(e,t)=>{if(e&&e!==t)return e.props.formCreateInject?e.props.formCreateInject:e.parent?Be(e.parent,t):void 0};function De(e,t,i){return r({name:Ie,components:t,directives:i,props:{rule:{type:Array,required:!0,default:()=>[]},option:{type:Object,default:()=>({})},extendOption:Boolean,modelValue:Object,disabled:{type:Boolean,default:void 0},api:Object,name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},emits:["update:api","update:modelValue","mounted","submit","change","emit-event","control","remove-rule","remove-field","sync","reload","repeat-field","update","validate-field-fail","validate-fail","created"],render(){return this.fc.render()},setup(t){const i=p();f("parentFC",i);const r=m("parentFC",null),{rule:n,modelValue:s,subForm:o,inFor:a}=g(t),l=h({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:[...n.value||[]],updateValue:JSON.stringify(s.value||{})}),c=new e(i),_=c.api(),w=a.value,C=()=>{const e=Be(i,r);if(e)if(w){const t=F(e.getSubForm()),i=t.indexOf(_);i>-1&&t.splice(i,1)}else e.subForm()};let $=null;return y((()=>{let e="";const i=t.option&&t.option.globalClass||{};Object.keys(i).forEach((t=>{let r="";i[t].style&&Object.keys(i[t].style).forEach((e=>{r+=be(e)+":"+i[t].style[e]+";"})),i[t].content&&(r+=i[t].content+";"),r&&(e+=`.${t}{${r}}`)})),t.option&&t.option.style&&(e+=t.option.style),e&&($=document.createElement("style"),$.type="text/css",$.innerHTML=e,document.head.appendChild($))})),v((()=>{c.mounted()})),b((()=>{$&&document.head.removeChild($),C(),l.destroyed=!0,c.unmount()})),x((()=>{c.updated()})),d(o,(e=>{e?(()=>{if(r){const e=Be(i,r);if(e){let t;w?(t=F(e.getSubForm()),t.push(_)):t=_,e.subForm(t)}}})():C()}),{immediate:!0}),d((()=>[...n.value]),(e=>{c.$handle.isBreakWatch()||e.length===l.renderRule.length&&e.every((e=>l.renderRule.indexOf(e)>-1))||(c.$handle.reloadRule(n.value),i.setupState.renderRule())})),d((()=>t.option),(()=>{c.initOptions(),_.refresh()}),{deep:!0}),d((()=>t.disabled),(()=>{_.refresh()})),d(s,(e=>{JSON.stringify(e||{})!==l.updateValue&&(_.config.forceCoverValue?_.coverValue(e||{}):_.setValue(e||{}))}),{deep:!0}),{fc:u(c),parent:r?u(r):r,fapi:u(_),...g(l),refresh(){++l.unique},renderRule(){l.renderRule=[...n.value||[]]},updateValue(e){if(l.destroyed)return;const t=JSON.stringify(e);l.updateValue!==t&&(l.updateValue=t,i.emit("update:modelValue",e))}}},created(){const e=p();e.emit("update:api",e.setupState.fapi),e.setupState.fc.init()}})}const Te=["props"],Ne=["class","style","directives"],Le=["on"],Me=(e,t={},i={})=>{const r=[...Te,...i.normal||[]],n=[...Ne,...i.array||[]],s=[...Le,...i.functional||[]],o=i.props||[];return e.reduce(((e,t)=>{for(const i in t)if(e[i])if(o.indexOf(i)>-1)e[i]=Me([t[i]],e[i]);else if(r.indexOf(i)>-1)e[i]={...e[i],...t[i]};else if(n.indexOf(i)>-1){const r=e[i]instanceof Array?e[i]:[e[i]],n=t[i]instanceof Array?t[i]:[t[i]];e[i]=[...r,...n]}else if(s.indexOf(i)>-1)for(const r in t[i])if(e[i][r]){const n=e[i][r]instanceof Array?e[i][r]:[e[i][r]],s=t[i][r]instanceof Array?t[i][r]:[t[i][r]];e[i][r]=[...n,...s]}else e[i][r]=t[i][r];else if("hook"===i)for(let r in t[i])e[i][r]?e[i][r]=Ue(e[i][r],t[i][r]):e[i][r]=t[i][r];else e[i]=t[i];else r.indexOf(i)>-1||s.indexOf(i)>-1||o.indexOf(i)>-1?e[i]={...t[i]}:n.indexOf(i)>-1?e[i]=t[i]instanceof Array?[...t[i]]:"object"==typeof t[i]?{...t[i]}:t[i]:e[i]=t[i];return e}),t)},Ue=(e,t)=>function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)},qe=["type","slot","emitPrefix","value","name","native","hidden","display","inject","options","emit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache","modelEmit"],He=["validate","children","control"],ze=["effect"];function Ge(){return[...qe,...Te,...Ne,...Le,...He,...ze]}function Je(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function Ye(e,t){return We([e],t||!1)[0]}function We(e,t){return se([],[...e],t||!1)}function Ke(e,t){return Me(Array.isArray(t)?t:[t],e,{array:He,normal:ze}),e}function Qe(e){const t=te.Function(e.getRule)?e.getRule():e;return t.type||(t.type="input"),t}function Xe(e,t){Object.defineProperties(e,Object.keys(t).reduce(((e,i)=>(e[i]={get:()=>t[i]()},e)),{}))}function Ze(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function et(e,t){try{t=e()}catch(e){!function(e){_e(e.toString()),console.error(e)}(e)}return t}function tt(){const e={},t=e=>e||"default";return{setSlot(i,r){i=t(i),!r||Array.isArray(r)&&r.length||(e[i]||(e[i]=[]),e[i].push(r))},getSlot(i,r){i=t(i);const n=[];return(e[i]||[]).forEach((e=>{if(Array.isArray(e))n.push(...e);else if(te.Function(e)){const t=e(...r||[]);Array.isArray(t)?n.push(...t):n.push(t)}else te.Undef(e)||n.push(e)})),n},getSlots(){const t={};return Object.keys(e).forEach((e=>{t[e]=(...t)=>this.getSlot(e,t)})),t},slotLen:i=>(i=t(i),e[i]?e[i].length:0),mergeBag(e){if(!e)return this;const t=te.Function(e.getSlots)?e.getSlots():e;return Array.isArray(e)||c(e)?this.setSlot(void 0,(()=>e)):Object.keys(t).forEach((e=>{this.setSlot(e,t[e])})),this}}}function it(e){const t={...e.props||{}};return Object.keys(e.on||{}).forEach((i=>{const r=`on${n=i,n.replace(n[0],n[0].toLocaleUpperCase())}`;var n;Array.isArray(t[r])?t[r]=[...t[r],e.on[i]]:t[r]?t[r]=[t[r],e.on[i]]:t[r]=e.on[i]})),t.key=e.key,t.ref=e.ref,t.class=e.class,t.style=e.style,t.slot&&delete t.slot,t}function rt(e,t){return(i,r,n,s={})=>{const o=new nt(e,i,r,n,s);return t&&(te.Function(t)?t(o):o.props(t)),o}}function nt(e,t,i,r,n){this._data=le({props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0},{type:e,title:t,field:i,value:r,props:n||{}}),this.event=this.on}function st(e){e.forEach((e=>{nt.prototype[e]=function(t){return Ke(this._data,{[e]:arguments.length<2?t:{[t]:arguments[1]}}),this}}))}le(nt.prototype,{getRule(){return this._data},setProp(e,t){return re(this._data,e,t),this},modelField(e){return this._data.modelField=e,this},_clone(){const e=new this.constructor;return e._data=Ye(this._data),e}}),st(Ge());const ot=rt("");function at(e,t,i){let r=ot("",t);return r._data.type=e,r._data.title=i,r}function lt(){return{create:at,factory:rt}}function ct(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function ut(e){if("undefined"==typeof XMLHttpRequest)return;const t=new XMLHttpRequest,i=e.action;let r;t.onerror=function(t){e.onError(t)},t.onload=function(){if(t.status<200||t.status>=300)return e.onError(function(e,t,i){const r=`fail to ${e} ${i.status}'`,n=new Error(r);return n.status=i.status,n.url=e,n}(i,0,t),ct(t));e.onSuccess(ct(t))},t.open(e.method||"get",i,!0),e.data&&("json"!==(e.dataType||"").toLowerCase()?(r=new FormData,Object.keys(e.data).map((t=>{r.append(t,e.data[t])}))):(r=JSON.stringify(e.data),t.setRequestHeader("content-type","application/json"))),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);const n=e.headers||{};Object.keys(n).forEach((e=>{null!==n[e]&&t.setRequestHeader(e,n[e])})),t.send(r)}function dt(e){return oe(e)}function ht(e){function t(t){return te.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function i(i,r,n){t(i).forEach((t=>{e.getCtxs(t).forEach((t=>{re(t.rule,r,n),e.$render.clearCache(t)}))}))}function r(){const t=e.subForm;return Object.keys(t).reduce(((e,i)=>{const r=t[i];return r?(Array.isArray(r)?e.push(...r):e.push(r),e):e}),[])}const n={get config(){return e.options},set config(t){e.fc.options.value=t},get options(){return e.options},set options(t){e.fc.options.value=t},get form(){return e.form},get rule(){return e.rules},get parent(){return e.vm.setupState.parent&&e.vm.setupState.parent.setupState.fapi},get top(){return n.parent?n.parent.top:n},get children(){return r()},formData:i=>t(i).reduce(((t,i)=>{const r=e.getFieldCtx(i);return r?(t[r.field]=dt(r.rule.value),t):t}),{}),getValue(t){const i=e.getFieldCtx(t);if(i)return dt(i.rule.value)},coverValue(t){const i={...t||{}};e.deferSyncValue((()=>{n.fields().forEach((r=>{const n=e.fieldCtx[r];if(n){const e=ie(t,r);n.forEach((i=>{i.rule.value=e?t[r]:void 0})),delete i[r]}})),le(e.appendData,i)}))},setValue(t){let i=t;arguments.length>=2&&(i={[t]:arguments[1]}),e.deferSyncValue((()=>{Object.keys(i).forEach((t=>{const r=e.fieldCtx[t];if(!r)return e.appendData[t]=i[t];r.forEach((e=>{e.rule.value=i[t]}))}))}))},removeField(t){const i=e.getCtx(t);return e.deferSyncValue((()=>{e.getCtxs(t).forEach((e=>{e.rm()}))}),!0),i?i.origin:void 0},removeRule(e){const t=e&&Ze(e);if(t)return t.rm(),t.origin},fields:()=>e.fields(),append:(t,i,r)=>{let n,s=e.sort.length-1;const o=e.getCtx(i);if(o)if(r){if(n=o.getPending("children",o.rule.children),!Array.isArray(n))return;s=o.rule.children.length-1}else s=o.root.indexOf(o.origin),n=o.root;else n=e.rules;n.splice(s+1,0,t)},prepend:(t,i,r)=>{let n,s=0;const o=e.getCtx(i);if(o)if(r){if(n=o.getPending("children",o.rule.children),!Array.isArray(n))return}else s=o.root.indexOf(o.origin),n=o.root;else n=e.rules;n.splice(s,0,t)},hidden(t,r){i(r,"hidden",!!t),e.refresh()},hiddenStatus(t){const i=e.getCtx(t);if(i)return!!i.rule.hidden},display(t,r){i(r,"display",!!t),e.refresh()},displayStatus(t){const i=e.getCtx(t);if(i)return!!i.rule.display},disabled(i,r){t(r).forEach((t=>{e.getCtxs(t).forEach((e=>{re(e.rule.props,"disabled",!!i)}))})),e.refresh()},all:t=>Object.keys(e.ctxs).map((i=>{const r=e.ctxs[i];return t?r.origin:r.rule})),model:t=>e.fields().reduce(((i,r)=>{const n=e.fieldCtx[r][0];return i[r]=t?n.origin:n.rule,i}),{}),component:t=>Object.keys(e.nameCtx).reduce(((i,r)=>{const n=e.nameCtx[r].map((e=>t?e.origin:e.rule));return i[r]=1===n.length?n[0]:n,i}),{}),bind:()=>n.form,reload:t=>{e.reloadRule(t)},updateOptions(t){e.fc.updateOptions(t),n.refresh()},onSubmit(e){n.updateOptions({onSubmit:e})},sync:t=>{if(Array.isArray(t))return void t.forEach((e=>n.sync(e)));let i=te.Object(t)?Ze(t):e.getCtxs(t);i&&(i=Array.isArray(i)?i:[i],i.forEach((t=>{if(!t.deleted){const i=e.subForm[t.id];i&&(Array.isArray(i)?i.forEach((e=>{e.refresh()})):i&&i.refresh()),e.$render.clearCache(t)}})),e.refresh())},refresh:()=>{r().forEach((e=>{e.refresh()})),e.$render.clearCacheAll(),e.refresh()},refreshOptions(){e.$manager.updateOptions(e.options),n.refresh()},hideForm:t=>{e.vm.setupState.isShow=!t},changeStatus:()=>e.changeStatus,clearChangeStatus:()=>{e.changeStatus=!1},updateRule(t,i){e.getCtxs(t).forEach((e=>{le(e.rule,i)}))},updateRules(e){Object.keys(e).forEach((t=>{n.updateRule(t,e[t])}))},mergeRule:(t,i)=>{e.getCtxs(t).forEach((e=>{Ke(e.rule,i)}))},mergeRules(e){Object.keys(e).forEach((t=>{n.mergeRule(t,e[t])}))},getRule:(t,i)=>{const r=e.getCtx(t);if(r)return i?r.origin:r.rule},getRenderRule:t=>{const i=e.getCtx(t);if(i)return i.prop},getRefRule:t=>{const i=e.getCtxs(t);if(i){const e=i.map((e=>e.rule));return 1===e.length?e[0]:e}},setEffect(t,i,r){const n=e.getCtx(t);n&&i&&("$"===i[0]&&(i=i.substr(1)),ie(n.rule,"$"+i)&&re(n.rule,"$"+i,r),ie(n.rule,"effect")||(n.rule.effect={}),re(n.rule.effect,i,r))},clearEffectData(t,i){const r=e.getCtx(t);r&&(i&&"$"===i[0]&&(i=i.substr(1)),r.clearEffectData(i),n.sync(t))},updateValidate(e,t,r){r?n.mergeRule(e,{validate:t}):i(e,"validate",t)},updateValidates(e,t){Object.keys(e).forEach((i=>{n.updateValidate(i,e[i],t)}))},refreshValidate(){n.refresh()},resetFields(i){t(i).forEach((t=>{e.getCtxs(t).forEach((t=>{e.$render.clearCache(t),t.rule.value=dt(t.defaultValue)}))}))},method(e,t){const i=n.el(e);if(!i||!i[t])throw new Error(xe("err",`${t}方法不存在`));return(...e)=>i[t](...e)},exec:(e,t,...i)=>et((()=>n.method(e,t)(...i))),toJson:e=>Fe(n.rule,e),trigger(e,t,...i){const r=n.el(e);r&&r.$emit(t,...i)},el(t){const i=e.getCtx(t);if(i)return i.el||e.vm.refs[i.ref]},closeModal:t=>{e.bus.$emit("fc:closeModal:"+t)},getSubForm(t){const i=e.getCtx(t);return i?e.subForm[i.id]:void 0},getChildrenRuleList(t){const i="object"==typeof t,r=i?Ze(t):e.getCtx(t),s=r?r.rule:i?t:n.getRule(t);if(!s)return[];const o=[];var a;return(a=r?r.loadChildrenPending():s.children)&&a.forEach((e=>{"object"==typeof e&&(e.field&&o.push(e),o.push(...n.getChildrenRuleList(e)))})),o},getChildrenFormData:e=>n.getChildrenRuleList(e).reduce(((e,t)=>(e[t.field]=dt(t.value),e)),{}),setChildrenFormData(e,t,i){n.getChildrenRuleList(e).forEach((e=>{ie(t,e.field)?e.value=t[e.field]:i&&(e.value=void 0)}))},getGlobalEvent(e){let t=n.options.globalEvent[e];if(t)return"object"==typeof t&&(t=t.handle),Ee(t)},getGlobalData:t=>new Promise(((i,r)=>{let s=n.options.globalData[t];s||i(e.fc.loadData[t]),"fetch"===s.type?n.fetch(s).then((e=>{i({res:e,config:s})})).catch(r):i(s.data)})),nextTick(t){e.bus.$once("next-tick",t),e.refresh()},nextRefresh(t){e.nextRefresh(),t&&et(t)},deferSyncValue(t,i){e.deferSyncValue(t,i)},emit(t,...i){e.vm.emit(t,...i)},bus:e.bus,fetch(t){return e.options.beforeFetch&&et((()=>e.options.beforeFetch(t,{api:n}))),i=t,new Promise(((e,t)=>{ut({...i,onSuccess(t){let r=e=>e;const n=Ee(i.parse);te.Function(n)?r=n:n&&te.String(n)&&(r=e=>(n.split(".").forEach((t=>{e&&(e=e[t])})),e)),e(r(t))},onError(e){t(e)}})}));var i},helper:{tidyFields:t,props:i}};return["on","once","off"].forEach((t=>{n[t]=function(...i){e.bus[`$${t}`](...i)}})),n.changeValue=n.changeField=n.setValue,n}function pt(e){return ft(e.replace(/(-[a-z])/g,(function(e){return e.replace("-","").toLocaleUpperCase()})))}function ft(e){return e.replace(e[0],e[0].toLowerCase())}let mt=1;function gt(e){le(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm),id:mt++}),Xe(this,{options:()=>e.options,sort:()=>e.sort}),this.initCache(),this.initRender()}!function(e){le(e.prototype,{initCache(){this.clearCacheAll()},clearCache(e){e.rule.cache||(this.cache[e.id]?((!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id].parent&&this.clearCache(this.cache[e.id].parent),this.cache[e.id]=null):e.parent&&this.clearCache(e.parent))},clearCacheAll(){this.cache={}},setCache(e,t,i){this.cache[e.id]={vnode:t,use:!1,parent:i,slot:e.rule.slot}},getCache(e){const t=this.cache[e.id];if(t)return t.use=!0,t.vnode}})}(gt),function(e){le(e.prototype,{initRender(){this.cacheConfig={}},getTypeSlot(e){const t=i=>{if(i){let r;return e.rule.field&&(r=i.slots["field-"+be(e.rule.field)]||i.slots["field-"+e.rule.field]),r||(r=i.slots["type-"+be(e.type)]||i.slots["type-"+e.type]),r||t(i.setupState.parent)}};return t(this.vm)},render(){if(!this.vm.setupState.isShow)return;this.$manager.beforeRender();const e=tt();return this.sort.forEach((t=>{this.renderSlot(e,this.$handle.ctxs[t])})),this.$manager.render(e)},renderSlot(e,t,i){if(this.isFragment(t)){t.initProp(),this.mergeGlobal(t),t.initNone();const i=this.renderChildren(t.loadChildrenPending(),t),r=i.default;r&&e.setSlot(t.rule.slot,(()=>r())),delete i.default,e.mergeBag(i)}else e.setSlot(t.rule.slot,this.renderCtx(t,i))},mergeGlobal(e){this.$handle.options.global&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=_((()=>{const t=this.$handle.options.global;return Ke({},[t["*"],t[e.originType]||t[e.type]||t[e.type]||{}])}))),e.prop=Ke({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions(e){const t=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=t,e.prop.optionsTo&&t&&Ae(e.prop,e.prop.optionsTo,t)},deepSet(e){const t=e.rule.deep;t&&Object.keys(t).sort(((e,t)=>e.length<t.length?-1:1)).forEach((i=>{Ae(e.prop,i,t[i])}))},parseSide:(e,t)=>te.Object(e)?Ke({props:{formCreateInject:t.prop.props.formCreateInject}},e):e,renderSides(e,t,i){const r=t[i?"rule":"prop"];return[this.renderRule(this.parseSide(r.prefix,t)),e,this.renderRule(this.parseSide(r.suffix,t))]},renderId(e,t){const i=this.$handle["field"===t?"fieldCtx":"nameCtx"][e];return i?i.map((e=>this.renderCtx(e,e.parent))):void 0},renderCtx(e,t){try{if("hidden"===e.type)return;const i=e.rule;if(!this.cache[e.id]||this.cache[e.id].slot!==i.slot){let r;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);let n=e.prop;n.preview=!!(ie(n,"preview")?n.preview:this.options.preview),n.props.formCreateInject=this.injectProp(e);let s=!1!==n.cache;const o=n.preview;if(n.hidden)return void this.setCache(e,void 0,t);r=(...r)=>{const a={rule:i,prop:n,preview:o,api:this.$handle.api,model:n.model||{},slotValue:r};r.length&&i.slotUpdate&&et((()=>i.slotUpdate(a)));let l={};const c=e.loadChildrenPending();e.parser.renderChildren?l=e.parser.renderChildren(c,e):!1!==e.parser.loadChildren&&(l=this.renderChildren(c,e));const u=this.getTypeSlot(e);let d;return u?(a.children=l,d=u(a)):d=o?e.parser.preview(ce(l),e):e.parser.render(ce(l),e),d=this.renderSides(d,e),!e.input&&te.Undef(n.native)||!0===n.native||(d=this.$manager.makeWrap(e,d)),e.none&&(d=Array.isArray(d)?d.map((e=>e&&e.__v_isVNode?this.none(e):e)):this.none(d)),s&&this.setCache(e,(()=>this.stable(d)),t),d},this.setCache(e,r,t)}return(...t)=>{const i=this.getCache(e);if(i)return i(...t);if(this.cache[e.id])return;const r=this.renderCtx(e,e.parent);return r?r():void 0}}catch(e){return void console.error(e)}},none(e){if(e)return Array.isArray(e.props.class)?e.props.class.push("fc-none"):e.props.class=e.props.class?[e.props.class,"fc-none"]:"fc-none",e},stable(e){return(Array.isArray(e)?e:[e]).forEach((e=>{e&&e.__v_isVNode&&e.children&&"object"==typeof e.children&&(e.children.$stable=!0,this.stable(e.children))})),e},getModelField(e){return e.rule.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"modelValue"},isFragment:e=>"fragment"===e.type||"template"===e.type,injectProp(e){const t=this.vm.setupState;t.ctxInject[e.id]||(t.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:t=>{this.$handle.addSubForm(e,t)},getSubForm:()=>this.$handle.subForm[e.id],options:[],children:[],preview:!1,id:e.id,field:e.field,rule:e.rule,input:e.input});const i=t.ctxInject[e.id];return le(i,{preview:e.prop.preview,options:e.prop.options,children:e.loadChildrenPending()}),i},ctxProp(e){const{ref:t,key:i,rule:r}=e;this.$manager.mergeProp(e),e.parser.mergeProp(e);const n=[{ref:t,key:r.key||`${i}fc`,slot:void 0,on:{vnodeMounted:t=>{t.el.__rule__=e.rule,this.onMounted(e,t.el)},"fc.el":t=>{e.exportEl=t,t&&((t.$el||t).__rule__=e.rule)}}}];if(e.input){void 0!==this.vm.props.disabled&&(e.prop.props.disabled=!!this.vm.props.disabled);const t=this.getModelField(e),i={callback:t=>{this.onInput(e,t)},value:this.$handle.getFormData(e)};n.push({on:{[`update:${t}`]:i.callback,...e.prop.modelEmit?{[e.prop.modelEmit]:()=>this.onEmitInput(e)}:{}},props:{[t]:i.value}}),e.prop.model=i}return Me(n,e.prop),e.prop},onMounted(e,t){e.el=this.vm.refs[e.ref]||t,e.parser.mounted(e),this.$handle.effect(e,"mounted")},onInput(e,t){e.prop.modelEmit?this.$handle.onBaseInput(e,t):this.$handle.onInput(e,t)},onEmitInput(e){this.$handle.setValue(e,e.parser.toValue(e.modelValue,e),e.modelValue)},renderChildren(e,t){if(!te.trueArray(e))return{};const i=tt();return e.map((r=>{if(r)return te.String(r)?i.setSlot(null,r):r.__fc__?this.renderSlot(i,r.__fc__,t):void(r.type&&l((()=>{this.$handle.loadChildren(e,t),this.$handle.refresh()})))})),i.getSlots()},defaultRender(e,t){const i=e.prop;return i.component?this.vNode.makeComponent(i.component,i,t):this.vNode[e.type]?this.vNode[e.type](i,t):this.vNode[e.originType]?this.vNode[e.originType](i,t):this.vNode.make(ft(e.originType),i,t)},renderRule(e,t,i){if(!e)return;if(te.String(e))return e;let r;if(i)r=e.type;else if(r=e.is,e.type){r=pt(e.type);const t=this.vNode.aliasMap[r];t&&(r=pt(t))}if(!r)return;const n=tt();te.trueArray(e.children)&&e.children.forEach((e=>{e&&n.setSlot(null==e?void 0:e.slot,(()=>this.renderRule(e)))}));const s={...e};return delete s.type,delete s.is,this.vNode.make(r,s,n.mergeBag(t).getSlots())}})}(gt);const yt=["hook:updated","hook:mounted"];function vt(e,t,i){const r=Pe(),n=!!t.field;var s;le(this,{id:r,ref:r,wrapRef:r+"fi",rule:t,origin:t.__origin__||t,name:t.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],children:[],parent:null,group:t.subRule?this:null,cacheConfig:null,prop:{...t},computed:{},payload:{},refRule:{},input:n,el:void 0,exportEl:void 0,defaultValue:n?oe(i):void 0,field:t.field||void 0}),this.updateType(),this.updateKey(),s=this,Object.defineProperties(s.origin,{__fc__:Je(u(s),!0)}),this.update(e,!0)}le(vt.prototype,{getParentGroup(){let e=this.parent;for(;e;){if(e.group)return e;e=e.parent}},loadChildrenPending(){const e=this.rule.children||[];return Array.isArray(e)?e:this.loadPending({key:"children",origin:e,def:[],onLoad:e=>{this.$handle&&this.$handle.loadChildren(e,this)},onUpdate:(e,t)=>{this.$handle&&(e===t?this.$handle.loadChildren(e,this):this.$handle.updateChildren(this,e,t))},onReload:e=>{this.$handle?this.$handle.updateChildren(this,[],e):delete this.pending.children}})},loadPending(e){const{key:t,origin:i,def:r,onLoad:n,onReload:s,onUpdate:o}=e;if(this.pending[t]&&this.pending[t].origin===i)return this.getPending(t,r);delete this.pending[t];let a=i;if(te.Function(i)){let e=et((()=>i({rule:this.rule,api:this.$api,update:e=>{const n=e||r,s=this.getPending(t,r);this.setPending(t,i,n),o&&o(n,s)},reload:()=>{const e=this.getPending(t,r);delete this.pending[t],s&&s(e),this.$api&&this.$api.sync(this.rule)}})));e&&te.Function(e.then)?(e.then((e=>{const s=e||r;this.setPending(t,i,s),n&&n(s),this.$api&&this.$api.sync(this.rule)})).catch((e=>{console.error(e)})),a=r,this.setPending(t,i,a)):(a=e||r,this.setPending(t,i,a),n&&n(a))}return a},getPending(e,t){return this.pending[e]&&this.pending[e].value||t},setPending(e,t,i){this.pending[e]={origin:t,value:h(i)}},effectData(e){return this.payload[e]||(this.payload[e]={}),this.payload[e]},clearEffectData(e){void 0===e?this.payload={}:delete this.payload[e]},updateKey(e){this.key=Pe(),e&&this.parent&&this.parent.updateKey(e)},updateType(){this.originType=this.rule.type,this.type=pt(this.rule.type)},setParser(e){this.parser=e,e.init(this)},initProp(){const e={...this.rule};delete e.children,this.prop=Ke({},[e,...Object.keys(this.payload).map((e=>this.payload[e])),this.computed])},initNone(){this.none=!(te.Undef(this.prop.display)||this.prop.display)},injectValidate(){return F(this.prop.validate).map((e=>({...e,inject:{id:this.id,field:this.field,rule:this.rule,api:this.$handle.api}})))},check(e){return this.vm===e.vm},unwatch(){this.watch.forEach((e=>e())),this.watch=[],this.refRule={}},unlink(){this.linkOn.forEach((e=>e())),this.linkOn=[]},link(){this.unlink(),this.$handle.appendLink(this)},watchTo(){this.$handle.watchCtx(this)},delete(){const e=void 0;this.unwatch(),this.unlink(),this.rmCtrl(),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this)>>>0,1),le(this,{deleted:!0,prop:{...this.rule},computed:{},el:e,$handle:e,$render:e,$api:e,vm:e,vNode:e,parent:null,children:[],cacheConfig:null,none:!1})},rmCtrl(){this.ctrlRule.forEach((e=>e.__fc__&&e.__fc__.rm())),this.ctrlRule=[]},rm(){const e=()=>{let e=this.root.indexOf(this.origin);e>-1&&(this.root.splice(e,1),this.$handle&&this.$handle.refresh())};this.deleted?e():this.$handle.noWatch((()=>{this.$handle.deferSyncValue((()=>{this.rmCtrl(),e(),this.$handle.rmCtx(this),le(this,{root:[]})}),this.input)}))},update(e,t){le(this,{deleted:!1,$handle:e,$render:e.$render,$api:e.api,vm:e.vm,trueType:e.getType(this.originType),vNode:e.$render.vNode,updated:!1,cacheValue:this.rule.value}),!t&&this.unwatch(),this.watchTo(),this.link()}});const bt={"==":e=>t=>t===e,"!=":e=>t=>t!==e,"<>":e=>t=>t!==e,">":e=>t=>t>e,">=":e=>t=>t>=e,"<":e=>t=>t<e,"<=":e=>t=>t<=e,in:e=>t=>e&&e.indexOf&&e.indexOf(t)>-1,on:e=>t=>t&&t.indexOf&&t.indexOf(e)>-1,notIn:e=>t=>!bt.in(e)(t),notOn:e=>t=>!bt.on(e)(t),between:e=>t=>t>e[0]&&t<e[1],notBetween:e=>t=>t<e[0]||t>e[1]};function xt(e,t){for(let i=0;i<e.ctrlRule.length;i++){const r=e.ctrlRule[i];if(r.children===t)return r}}function _t(e){return!!e.rule.__ctrl}function wt(e,t){return"function"==typeof t?""+t:t}const Ct={init(e){},toFormValue:(e,t)=>e,toValue:(e,t)=>e,mounted(e){},render:(e,t)=>t.$render.defaultRender(t,e),preview(e,t){return this.render(e,t)},mergeProp(e){}},$t=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"];function kt(e){Xe(this,{options:()=>e.options.value||{},bus:()=>e.bus}),le(this,{fc:e,vm:e.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:h({}),subRuleData:h({}),subForm:{},form:h({}),appendData:{},providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:()=>{this.lifecycle("reload")}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new gt(this),this.api=e.extendApi(ht(this),this)}le(kt.prototype,{initData(e){le(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:e})},init(){this.appendData={...this.options.formData||{},...this.fc.vm.props.modelValue||{},...this.appendData},this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.lifecycle("created")},isBreakWatch(){return this.loading||this.noWatchFn||this.reloading}}),function(e){le(e.prototype,{parseInjectEvent(e,t){const i=e.inject||this.options.injectEvent;return this.parseEventLst(e,t,i)},parseEventLst(e,t,i,r){return Object.keys(t).forEach((n=>{const s=this.parseEvent(e,t[n],i,r);s&&(t[n]=s)})),t},parseEvent(e,t,i,r){if(te.Function(t)&&(!1!==i&&!te.Undef(i)||t.__inject))return this.inject(e,t,i);if(!r&&Array.isArray(t)&&t[0]&&(te.String(t[0])||te.Function(t[0])))return this.parseEventLst(e,t,i,!0);if(te.String(t)){const r=Ee(t);if(r&&t!==r)return r.__inject?this.parseEvent(e,r,i,!0):r}},parseEmit(e){let t={},i=e.rule,{emitPrefix:r,field:n,name:s,inject:o}=i,a=i.emit||[];return te.trueArray(a)&&a.forEach((e=>{if(!e)return;let a,l=r||n||s;if(te.Object(e)&&(a=e.inject,l=(e=e.name).prefix||l),l){const r=be(`${l}-${e}`),n=(...e)=>{this.vm.emitsOptions&&(this.vm.emitsOptions[r]=null),this.vm.emit(r,...e),this.vm.emit("emit-event",r,...e),this.bus.$emit(r,...e)};if(n.__emit=!0,a||!1!==o){let r=a||o||this.options.injectEvent;t[e]=te.Undef(r)?n:this.inject(i,n,r)}else t[e]=n}})),e.computed.on=t,t},getInjectData(e,t){const{option:i,rule:r}=this.vm.props;return{$f:this.api,api:this.api,rule:r,self:e.__origin__,option:i,inject:t}},inject(e,t,i){if(t.__origin){if(this.watching&&!this.loading)return t;t=t.__origin}const r=this,n=function(...n){const s=r.getInjectData(e,i);return s.args=[...n],n.unshift(s),t.apply(this,n)};return n.__origin=t,n.__json=t.__json,n}})}(kt),function(e){le(e.prototype,{usePage(){const e=this.options.page;if(!e)return;let t=25,i=(r=this.rules).length<31?31:Math.ceil(r.length/3);var r;te.Object(e)&&(e.first&&(t=parseInt(e.first,10)||t),e.limit&&(i=parseInt(e.limit,10)||i)),le(this,{first:t,limit:i,pageEnd:this.rules.length<=t}),this.bus.$on("page-end",(()=>this.vm.emit("page-end",this.api))),this.pageLoad()},pageLoad(){const e=()=>{this.pageEnd?(this.bus.$off(yt,e),this.bus.$emit("page-end")):(this.first+=this.limit,this.pageEnd=this.rules.length<=this.first,this.loadRule(),this.refresh())};this.bus.$on(yt,e)}})}(kt),function(e){le(e.prototype,{clearNextTick(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick(e){this.clearNextTick(),this.nextTick=setTimeout((()=>{e(),this.nextTick=null}),10)},render(){return++this.loadedId,this.vm.setupState.unique>0?this.$render.render():(this.vm.setupState.unique=1,[])}})}(kt),function(e){le(e.prototype,{nextRefresh(e){const t=this.loadedId;l((()=>{t===this.loadedId&&(e?e():this.refresh())}))},parseRule(e){const t=Qe(e);return Object.defineProperties(t,{__origin__:Je(e,!0)}),function(e){const t={props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0};Object.keys(t).forEach((i=>{ie(e,i)||(e[i]=t[i])}))}(t),this.appendValue(t),[t,t.prefix,t.suffix].forEach((e=>{e&&this.loadFn(e,t)})),this.loadCtrl(t),t.update&&(t.update=Ee(t.update)),t},loadFn(e,t){["on","props","deep"].forEach((i=>{e[i]&&this.parseInjectEvent(t,e[i])}))},loadCtrl(e){e.control&&e.control.forEach((e=>{e.handle&&(e.handle=Ee(e.handle))}))},syncProp(e){const t=e.rule;te.trueArray(t.sync)&&Me([{on:t.sync.reduce(((e,i)=>(e[`update:${i}`]=e=>{t.props[i]=e,this.vm.emit("sync",i,e,t,this.fapi)},e)),{})}],e.computed)},loadRule(){this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue((()=>{if(this._loadRule(this.rules),this.loading=!1,this.cycleLoad&&this.pageEnd)return this.loadRule();this.syncForm(),this.pageEnd&&this.bus.$emit("load-end"),this.vm.setupState.renderRule()}))},loadChildren(e,t){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,t),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(t)},_loadRule(e,t){const i=t=>{let r=e[t-1];if(!r||!r.__fc__)return t>0?i(t-1):-1;let n=this.sort.indexOf(r.__fc__.id);return n>-1?n:i(t-1)},r=(e,t)=>{te.trueArray(e)&&this._loadRule(e,t)},n=e.map(((n,s)=>{if(t&&!te.Object(n))return;if(!this.pageEnd&&!t&&s>=this.first)return;if(n.__fc__&&n.__fc__.root===e&&this.ctxs[n.__fc__.id])return r(n.__fc__.loadChildrenPending(),n.__fc__),n.__fc__;let o=Qe(n);const a=()=>!(!o.field||!this.fieldCtx[o.field]||this.fieldCtx[o.field][0]===n.__fc__);let l;this.ruleEffect(o,"init",{repeat:a()}),a()&&this.vm.emit("repeat-field",n,this.api);let c=!1,u=!!n.__fc__,d=o.value;if(u){l=n.__fc__,d=l.defaultValue;const t=!l.check(this);if(l.deleted){if(t){if(_t(l))return;l.update(this)}}else if(t){if(_t(l))return;e[s]=n=n._clone?n._clone():Ye(n),l=null,c=!0}}if(l)l.originType!==l.rule.type&&(l.updateType(),this.bindParser(l)),this.appendValue(l.rule),l.parent&&l.parent!==t&&this.rmSubRuleData(l);else{const e=this.parseRule(n);l=new vt(this,e,u?d:e.value),this.bindParser(l)}this.parseEmit(l),this.syncProp(l),l.parent=t||null,l.root=e,this.setCtx(l),!c&&!u&&this.effect(l,"load"),this.effect(l,"created");const h=l.loadChildrenPending();if(!1===l.parser.loadChildren||r(h,l),!t){const e=i(s);e>-1||!s?this.sort.splice(e+1,0,l.id):this.sort.push(l.id)}const p=l.rule;return l.updated||(l.updated=!0,te.Function(p.update)&&this.bus.$once("load-end",(()=>{this.refreshUpdate(l,p.value,"init")})),this.effect(l,"loaded")),this.refreshControl(l)&&(this.cycleLoad=!0),l})).filter((e=>!!e));t&&(t.children=n)},refreshControl(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl(e){const t=function(e){const t=e.rule.control||[];return te.Object(t)?[t]:t}(e),i=[],r=this.api;if(!t.length)return!1;for(let n=0;n<t.length;n++){const s=t[n],o=s.handle||(bt[s.condition||"=="]||bt["=="])(s.value);if(!te.trueArray(s.rule))continue;const a={...s,valid:et((()=>o(e.rule.value,r))),ctrl:xt(e,s.rule),isHidden:te.String(s.rule[0])};a.valid&&a.ctrl||!a.valid&&!a.ctrl&&!a.isHidden||i.push(a)}if(!i.length)return!1;const n=[];let s=!1;return this.deferSyncValue((()=>{i.reverse().forEach((({isHidden:t,valid:i,rule:o,prepend:a,append:l,child:c,ctrl:u,method:d})=>{if(t)return i?e.ctrlRule.push({__ctrl:!0,children:o,valid:i}):e.ctrlRule.splice(e.ctrlRule.indexOf(u),1),void n[i?"push":"unshift"]((()=>{"disabled"===d?this.api.disabled(!i,o):"display"===d?this.api.display(i,o):"required"===d?(o.forEach((e=>{this.api.setEffect(e,"required",i)})),i||this.api.clearValidateState(o)):this.api.hidden(!i,o)}));if(i){s=!0;const t={type:"fragment",native:!0,__ctrl:!0,children:o};e.ctrlRule.push(t),this.bus.$once("load-start",(()=>{a?r.prepend(t,a,c):l||c?r.append(t,l||e.id,c):e.root.splice(e.root.indexOf(e.origin)+1,0,t)}))}else{e.ctrlRule.splice(e.ctrlRule.indexOf(u),1);const t=Ze(u);t&&t.rm()}}))})),n.length&&l((()=>{n.forEach((e=>e()))})),this.vm.emit("control",e.origin,this.api),this.effect(e,"control"),s},reloadRule(e){return this._reloadRule(e)},_reloadRule(e){e||(e=this.rules);const t={...this.ctxs};this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue((()=>{this.bus.$once("load-end",(()=>{Object.keys(t).filter((e=>void 0===this.ctxs[e])).forEach((e=>this.rmCtx(t[e]))),this.$render.clearCacheAll()})),this.reloading=!0,this.loadRule(),this.reloading=!1,this.refresh(),this.bus.$emit("reloading",this.api)})),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.bus.$emit("update",this.api)},refresh(){this.vm.setupState.refresh()}})}(kt),function(e){le(e.prototype,{setValue(e,t,i,r){e.deleted||(e.rule.value=t,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,i),this.syncValue(),this.valueChange(e,t),this.vm.emit("change",e.field,t,e.origin,this.api,r||!1),this.effect(e,"value"),this.emitEvent("change",e.field,t,{rule:e.origin,api:this.api,setFlag:r||!1}))},onInput(e,t){let i;e.input&&(this.isQuote(e,i=e.parser.toValue(t,e))||this.isChange(e,t))&&this.setValue(e,i,t)},onBaseInput(e,t){this.setFormData(e,t),e.modelValue=t,this.nextRefresh(),this.$render.clearCache(e)},setFormData(e,t){e.modelValue=t;const i=e.getParentGroup();i&&(this.subRuleData[i.id]||(this.subRuleData[i.id]={}),this.subRuleData[i.id][e.field]=e.rule.value),re(this.formData,e.id,t)},rmSubRuleData(e){const t=e.getParentGroup();t&&this.subRuleData[t.id]&&delete this.subRuleData[t.id][e.field]},getFormData(e){return this.formData[e.id]},syncForm(){const e=h({});this.fields().reduce(((e,t)=>{const i=this.getCtx(t);return e[t]=w(i.rule,"value"),e}),e),this.form=e,this.syncValue()},appendValue(e){e.field&&ie(this.appendData,e.field)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm(e,t){this.subForm[e.id]=t},deferSyncValue(e,t){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=t),et(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncValue())},syncValue(){if(this.deferSyncFn)return this.deferSyncFn.sync=!0;this.vm.setupState.updateValue({...this.form})},isChange(e,t){return JSON.stringify(this.getFormData(e),wt)!==JSON.stringify(t,wt)},isQuote:(e,t)=>(te.Object(t)||Array.isArray(t))&&t===e.rule.value,refreshUpdate(e,t,i,r){if(te.Function(e.rule.update)){const n=et((()=>e.rule.update(t,e.origin,this.api,{origin:i||"change",linkField:r})));if(void 0===n)return;e.rule.hidden=!0===n}},valueChange(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule(e,t,i,r){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.bus.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,t,i,r)},appendLink(e){const t=e.rule.link;te.trueArray(t)&&t.forEach((t=>{const i=()=>this.refreshRule(e,e.rule.value,"link",t);this.bus.$on("change-"+t,i),e.linkOn.push((()=>this.bus.$off("change-"+t,i)))}))},fields(){return Object.keys(this.fieldCtx)}})}(kt),function(e){le(e.prototype,{getCtx(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx(e,t,i){const r=`${i}Ctx`;this[r][t]?this[r][t].push(e):this[r][t]=[e]},rmIdCtx(e,t,i){const r=`${i}Ctx`,n=this[r][t];if(!n)return!1;const s=n.splice(n.indexOf(e)>>>0,1).length>0;return n.length||delete this[r][t],s},getFieldCtx(e){return(this.fieldCtx[e]||[])[0]},getNameCtx(e){return this.nameCtx[e]||[]},setCtx(e){let{id:t,field:i,name:r,rule:n}=e;this.ctxs[t]=e,r&&this.setIdCtx(e,r,"name"),e.input&&(this.setIdCtx(e,i,"field"),this.setFormData(e,e.parser.toFormValue(n.value,e)),this.isMounted&&!this.reloading&&this.vm.emit("change",e.field,n.value,e.origin,this.api))},getParser(e){const t=this.fc.parsers;return t[e.originType]||t[pt(e.type)]||t[e.trueType]||Ct},bindParser(e){e.setParser(this.getParser(e))},getType(e){const t=this.fc.CreateNode.aliasMap,i=t[e]||t[pt(e)]||e;return pt(i)},noWatch(e){this.noWatchFn||(this.noWatchFn=e),et(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx(e){if(Ge().filter((e=>"_"!==e[0]&&"$"!==e[0]&&-1===$t.indexOf(e))).forEach((t=>{const i=w(e.rule,t),r="children"===t;e.refRule[t]=i,e.watch.push(d(r?()=>te.Function(i.value)?i.value:[...i.value||[]]:()=>i.value,((n,s)=>{let o=i.value;if(!this.isBreakWatch()){if(r&&!1===e.parser.loadChildren)return this.$render.clearCache(e),void this.nextRefresh();this.watching=!0,"link"!==t?(["props","on","deep"].indexOf(t)>-1?(this.parseInjectEvent(e.rule,o||{}),"props"===t&&e.input&&this.setFormData(e,e.parser.toFormValue(e.rule.value,e))):"emit"===t?this.parseEmit(e):"hidden"===t&&Boolean(o)!==Boolean(s)?this.$render.clearCacheAll():["prefix","suffix"].indexOf(t)>-1?o&&this.loadFn(o,e.rule):"type"===t?(e.updateType(),this.bindParser(e)):r&&(te.Function(s)&&(s=e.getPending("children",[])),te.Function(o)&&(o=e.loadChildrenPending()),this.updateChildren(e,o,s)),this.$render.clearCache(e),this.refresh(),this.watching=!1):e.link()}}),{deep:!r,sync:r}))})),e.input){const t=w(e.rule,"value");e.watch.push(d((()=>t.value),(()=>{let i=e.parser.toFormValue(t.value,e);this.isChange(e,i)&&this.setValue(e,t.value,i,!0)})))}this.bus.$once("load-end",(()=>{let t=e.rule.computed;t&&("object"!=typeof t&&(t={value:t}),Object.keys(t).forEach((i=>{e.watch.push(d((()=>{const r=t[i];if(!r)return;let n;if(te.Function(r))n=()=>r(this.api.form,this.api);else{const t=e.getParentGroup();n=()=>new Function("formulas","top","group","$rule","$api",`with(top){with(this){with(group){with(formulas){ return ${r} }}}}`).call(this.api.form,this.fc.formulas,this.api.top.form,t&&this.subRuleData[t.id]||{},e.rule,this.api)}return et(n,void 0)}),(t=>{setTimeout((()=>{"value"===i?this.onInput(e,t):"$"===i[0]?this.api.setEffect(e.id,i,t):Ae(e.rule,i,t)}))}),{immediate:!0}))})))})),this.watchEffect(e)},updateChildren(e,t,i){this.deferSyncValue((()=>{i&&i.forEach((i=>{-1===(t||[]).indexOf(i)&&i&&!te.String(i)&&i.__fc__&&i.__fc__.parent===e&&i.__fc__.root!==t&&this.rmCtx(i.__fc__)})),te.trueArray(t)&&(this.loadChildren(t,e),this.bus.$emit("update",this.api))}))},rmSub(e){te.trueArray(e)&&e.forEach((e=>{e&&e.__fc__&&this.rmCtx(e.__fc__)}))},rmCtx(e){if(e.deleted)return;const{id:t,field:i,input:r,name:n}=e;ne(this.ctxs,t),ne(this.formData,t),ne(this.subForm,t),ne(this.vm.setupState.ctxInject,t);const s=e.getParentGroup();s&&this.subRuleData[s.id]&&ne(this.subRuleData[s.id],i),e.group&&ne(this.subRuleData,t),r&&this.rmIdCtx(e,i,"field"),n&&this.rmIdCtx(e,n,"name"),r&&!ie(this.fieldCtx,i)&&ne(this.form,i),this.deferSyncValue((()=>{if(!this.reloading){if(!1!==e.parser.loadChildren){const t=e.getPending("children",e.rule.children);te.trueArray(t)&&t.forEach((e=>e.__fc__&&this.rmCtx(e.__fc__)))}e.root===this.rules&&this.vm.setupState.renderRule()}}),r);const o=this.sort.indexOf(t);return o>-1&&this.sort.splice(o,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),r&&!this.fieldCtx[i]&&this.vm.emit("remove-field",i,e.rule,this.api),e.rule.__ctrl||this.vm.emit("remove-rule",e.rule,this.api),e}})}(kt),function(e){le(e.prototype,{mounted(){const e=()=>{this.isMounted=!0,this.lifecycle("mounted")};this.pageEnd?e():this.bus.$once("page-end",e)},lifecycle(e){this.vm.emit(e,this.api),this.emitEvent(e,this.api)},emitEvent(e,...t){const i=this.options[e]||this.options[pt("on-"+e)];if(i){const e=Ee(i);te.Function(e)&&et((()=>e(...t)))}this.bus.$emit(e,...t)}})}(kt),function(e){le(e.prototype,{useProvider(){const e=this.fc.providers;Object.keys(e).forEach((t=>{let i=e[t];te.Function(i)&&(i=i(this.fc)),i._c=function(e){const t=e.components;if(Array.isArray(t)){const e=function(e){return e.filter((function(e,t,i){return i.indexOf(e,0)===t}))}(t.filter((e=>"*"!==e)));return!!e.length&&e}return!!te.String(t)&&[t]}(i),this.onEffect(i),this.providers[t]=i}))},onEffect(e){const t=[];(e._c||["*"]).forEach((i=>{const r="*"===i?"*":this.getType(i);t.indexOf(r)>-1||(t.push(r),this.bus.$on(`p:${e.name}:${r}:${e.input?1:0}`,((t,i)=>{e[t]&&e[t](...i)})))})),e._used=t},watchEffect(e){let t={required:()=>{var t;return(ie(e.rule,"$required")?e.rule.$required:null===(t=e.rule)||void 0===t||null===(t=t.effect)||void 0===t?void 0:t.required)||!1}};Object.keys(e.rule.effect||{}).forEach((i=>{t[i]=()=>e.rule.effect[i]})),Object.keys(e.rule).forEach((i=>{"$"===i[0]&&(t[i.substr(1)]=()=>e.rule[i])})),Object.keys(t).forEach((i=>{e.watch.push(d(t[i],(t=>{this.effect(e,"watch",{[i]:t})}),{deep:!0}))}))},ruleEffect(e,t,i){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t,i)},effect(e,t,i){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:i},t)},getEffect:(e,t)=>ie(e,"$"+t)?e["$"+t]:ie(e,"effect")&&ie(e.effect,t)?e.effect[t]:void 0,emitEffect({ctx:e,rule:t,input:i,type:r,custom:n},s,o){if(!r||["fcFragment","fragment"].indexOf(r)>-1)return;const a=n||Object.keys(t).reduce(((e,i)=>("$"===i[0]&&(e[i.substr(1)]=t[i]),e)),{...t.effect||{}});Object.keys(a).forEach((n=>{const l=this.providers[n];if(!l||l.input&&!i)return;let c;if(l._c){if(!(l._used.indexOf(r)>-1))return;c=r}else c="*";const u={value:a[n],getValue:()=>this.getEffect(t,n),...o||{}};e&&(u.getProp=()=>e.effectData(n),u.clearProp=()=>e.clearEffectData(n),u.mergeProp=e=>Ke(u.getProp(),[e]),u.id=e.id),this.bus.$emit(`p:${n}:${c}:${l.input?1:0}`,s,[u,t,this.api])}))}})}(kt);var Ot=r({name:"fcFragment",inheritAttrs:!1,props:["vnode"],render(){return this.vnode}});function St(e,t){let i=e.directives;return i?(Array.isArray(i)||(i=[i]),C(t,i.reduce(((e,t)=>e.concat(function(e){return Object.keys(e).map((t=>{const i=e[t],r=$(t);if(r)return[r,i.value,i.arg,i.modifiers]})).filter((e=>!!e))}(t))),[]))):t}function Ft(){const e={};function t(){}return le(t.prototype,{make(e,t,i){return St(t,this.h(e,it(t),i))},makeComponent(e,t,i){try{return St(t,s(e,it(t),i))}catch(e){return console.error(e),s("")}},h(e,t,i){const r=p().appContext.config.isNativeTag(e);r&&delete t.formCreateInject;try{return s(r?e:n(e),t,i)}catch(e){return console.error(e),s("")}},aliasMap:e}),le(t,{aliasMap:e,alias(t,i){e[t]=i},use(e){Object.keys(e).forEach((i=>{const r=be(i),n=(s=i,null==s?"":"object"==typeof s?JSON.stringify(s,null,2):String(s)).toLocaleLowerCase();var s;const o=e[i];[i,r,n].forEach((e=>{t.alias(i,o),t.prototype[e]=function(e,t){return this.make(o,e,t)}}))}))}}),t}function Rt(e){class t extends Et{}return Object.assign(t.prototype,e),t}function Et(e){le(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}le(Et.prototype,{__init(){this.$render=this.$handle.$render,this.$r=(...e)=>this.$render.renderRule(...e)},updateKey(){this.key=Pe()},init(){},update(){},beforeRender(){},form(){return this.vm.refs[this.ref]},getSlot(e){const t=i=>{if(i){let r=i.slots[e];return r||t(i.setupState.parent)}};return t(this.vm)},mergeOptions(e,t){return Me(e.map((e=>this.tidyOptions(e))),t,this.mergeOptionsRule)},updateOptions(e){this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:e=>e,tidyRule(e){},mergeProp(e){},getDefaultOptions:()=>({}),render(e){}});const Vt={name:"componentValidate",load(e,t,i){const r=e.getValue();r?e.getProp().validate=[{validator(...n){const s=Ze(t);if(s)return i.exec(s.id,!0===r?"formCreateValidate":r,...n,{attr:e,rule:t,api:i})}}]:(e.clearProp(),i.clearValidateState([t.field]))},watch(...e){Vt.load(...e)}};var jt={fetch:function(e){function t(t,i,r){let n=t.value;te.Function(n)&&(n=n(i,r)),n=function(e){return te.String(e)&&(e={action:e,to:"options"}),e}(n);const s=e=>{void 0===e?t.clearProp():Ae(t.getProp(),n.to||"options",e),r.sync(i)};if(!n||!n.action&&!n.key)return void s(void 0);if(n.to||(n.to="options"),n.key){const t=e.$handle.options.globalData[n.key];if(!t)return void s(void 0);if("static"===t.type)return void s(t.data);n={...n,...t}}const o=n.onError,a=()=>{if(!t.getValue())return t.clearProp(),r.sync(i),!0},l={headers:{},...n,onSuccess(e,t){if(a())return;let o=e=>t?e:e.data;const l=Ee(n.parse);te.Function(l)?o=l:l&&te.String(l)&&(o=e=>(l.split(".").forEach((t=>{e&&(e=e[t])})),e)),s(o(e,i,r)),r.sync(i)},onError(e){s(void 0),a()||(o||(e=>_e(e.message||"fetch fail "+n.action)))(e,i,r)}};e.$handle.options.beforeFetch&&et((()=>e.$handle.options.beforeFetch(l,{rule:i,api:r}))),te.Function(n.action)?n.action(i,r).then((e=>{l.onSuccess(e,!0)})).catch((e=>{l.onError(e)})):et((()=>e.create.fetch(l,{inject:t,rule:i,api:r})))}return{name:"fetch",loaded(...e){t(...e)},watch(...e){t(...e)}}},loadData:function(e){const t={name:"loadData",_fn:[],created(t,i,r){this.deleted(t);let n=F(t.getValue());const s=[];n.forEach((n=>{if(n){const o=()=>{let s;!1!==n.watch&&(e.bus.$off("p.loadData."+n.attr,o),e.bus.$once("p.loadData."+n.attr,o)),n.attr&&(s=e.loadData[n.attr]||n.default,n.copy&&(s=oe(s))),Ae(t.getProp(),n.to||"options",s),r.sync(i)};s.push((()=>e.bus.$off("p.loadData."+n.attr,o))),o()}})),this._fn[t.id]=s},deleted(e){this._fn[e.id]&&this._fn[e.id].forEach((e=>{e()})),e.clearProp()}};return t.watch=t.created,t},componentValidate:Vt};var Pt={name:"html",loadChildren:!1,render:(e,t)=>(t.prop.props.innerHTML=e.default(),t.vNode.make(t.prop.props.tag||"div",t.prop)),renderChildren:e=>({default:()=>e.filter((e=>te.String(e))).join("")})};function At(){return function(e,t){let i;return 2===arguments.length?(i=arguments[1],t=i[e]):i=arguments[2],{id:t,prop:i}}("name",...arguments)}let It=1;const Bt={};function Dt(e){const t={[Ot.name]:Ot},i={},r={},n={},s=[],o={...jt},a=lt();let c={global:{}};const u={},p=Ft(),f={};function m(e){const t=Bt[e];return Array.isArray(t)?t.map((e=>e.api())):t?t.api():void 0}function g(e){s.push(e)}function y(){const e=At(...arguments);e.id&&e.prop&&(r[e.id]=e.prop)}function v(){const e=At(...arguments);e.id&&e.prop&&(o[e.id]={...e.prop,name:e.id})}function b(e){p.use(e)}function x(){const e=At(...arguments);if(!e.id||!e.prop)return Ct;const t=pt(e.id),r=e.prop,n=!0===r.merge?i[t]:void 0;var s,o;i[t]=(s=r,o=n||Ct,Object.setPrototypeOf(s,o),s),a[t]=rt(t),r.maker&&le(a,r.maker)}function _(e,r){let n;if(te.String(e)){if(n=e,void 0===r)return t[n]}else n=e.displayName||e.name,r=e;if(!n||!r)return;const s=pt(n);t[n]=r,t[s]=r,delete p.aliasMap[n],delete p.aliasMap[s],delete i[n],delete i[s],r.formCreateParser&&x(n,r.formCreateParser)}function w(){return De(I,t,r)}function C(){return Ot}function $(e,t){return te.Function(e.install)?e.install(F,t):te.Function(e)&&e(F,t),this}function F(e,t){let i=function(e,t){const i=w();return O({data:()=>h({rule:e,option:t}),render(){return S(i,{ref:"fc",...this.$data})}})}(e,t||{});s.forEach((e=>{et((()=>e(F,i)))}));const r=document.createElement("div");((null==t?void 0:t.el)||document.body).appendChild(r);return i.mount(r).$refs.fc.fapi}function R(l){let c={...e};return l?c.inherit={components:t,parsers:i,directives:r,modelFields:n,providers:o,useApps:s,maker:a,formulas:f,loadData:u}:delete c.inherit,Dt(c)}function E(e,t){n[e]=t}function V(e,t){f[e]=t}function j(e){Object.keys(Bt).forEach((t=>{(Array.isArray(Bt[t])?Bt[t]:[Bt[t]]).forEach((t=>{t.bus.$emit("p.loadData."+e)}))}))}function P(e,t){u[e]=t,j(e)}function A(e){delete u[e],j(e)}function I(s){le(this,{id:It++,create:F,vm:s,manager:Rt(e.manager),parsers:i,providers:o,modelFields:n,formulas:f,rules:s.props.rule,name:s.props.name||Pe(),inFor:s.props.inFor,prop:{components:t,directives:r},loadData:u,CreateNode:p,bus:new B,unwatch:null,options:k({}),extendApi:e.extendApi||(e=>e)}),l((()=>{d(this.options,(()=>{this.$handle.$manager.updateOptions(this.options.value),this.api().refresh()}),{deep:!0})})),le(s.appContext.components,t),le(s.appContext.directives,r),this.$handle=new kt(this),this.name&&(this.inFor?(Bt[this.name]||(Bt[this.name]=[]),Bt[this.name].push(this)):Bt[this.name]=this)}function D(t){le(t,{version:e.version,ui:e.ui,setData:P,removeData:A,maker:a,component:_,directive:y,setModelField:E,setFormula:V,register:v,$vnode:C,parser:x,use:$,factory:R,componentAlias:b,copyRule:Ye,copyRules:We,fetch:ut,$form:w,parseFn:Ee,parseJson:Ve,toJson:Fe,useApp:g,getApi:m})}var T;if(function(e){const t=e.key||[],i=e.array||[],r=e.normal||[];qe.push(...t),He.push(...i),ze.push(...r),st([...t,...i,...r])}(e.attrs||{}),le(I.prototype,{init(){this.isSub()&&(this.unwatch=d((()=>this.vm.setupState.parent.setupState.fc.options.value),(()=>{this.initOptions(),this.$handle.api.refresh()}),{deep:!0})),this.initOptions(),this.$handle.init()},isSub(){return this.vm.setupState.parent&&this.vm.props.extendOption},initOptions(){this.options.value={};let e={formData:{},submitBtn:{},resetBtn:{},globalEvent:{},globalData:{},...oe(c)};this.isSub()&&(e=this.mergeOptions(e,this.vm.setupState.parent.setupState.fc.options.value||{},!0)),e=this.mergeOptions(e,this.vm.props.option),this.updateOptions(e)},mergeOptions(e,t,i){return t=oe(t),i&&["page","onSubmit","mounted","reload","formData","el","globalClass","style"].forEach((e=>{delete t[e]})),t.global&&(e.global=function(e,t){return e?(Object.keys(t||{}).forEach((i=>{t[i]&&(e[i]=Ke(e[i]||{},t[i]))})),e):t}(e.global,t.global),delete t.global),this.$handle.$manager.mergeOptions([t],e),e},updateOptions(e){this.options.value=this.mergeOptions(this.options.value,e),this.$handle.$manager.updateOptions(this.options.value)},api(){return this.$handle.api},render(){return this.$handle.render()},mounted(){this.$handle.mounted()},unmount(){if(this.name)if(this.inFor){const e=Bt[this.name].indexOf(this);Bt[this.name].splice(e,1)}else delete Bt[this.name];this.unwatch&&this.unwatch(),this.$handle.reloadRule([])},updated(){this.$handle.bindNextTick((()=>this.bus.$emit("next-tick",this.$handle.api)))}}),D(F),le(T=F,{create:F,install(e,t){if(c={...c,...t||{}},!0===e._installedFormCreate)return;e._installedFormCreate=!0;const i=function(e,t={}){return F(e,t)};D(i),e.config.globalProperties.$formCreate=i,e.component("FormCreate",w()),s.forEach((t=>{et((()=>t(T,e)))}))}}),p.use({fragment:"fcFragment"}),e.install&&F.use(e),g(((e,t)=>{t.mixin({props:["formCreateInject"]})})),x(Pt),e.inherit){const l=e.inherit;l.components&&le(t,l.components),l.parsers&&le(i,l.parsers),l.directives&&le(r,l.directives),l.modelFields&&le(n,l.modelFields),l.providers&&le(o,l.providers),l.useApps&&le(s,l.useApps),l.maker&&le(a,l.maker),l.loadData&&le(u,l.loadData),l.formulas&&le(f,l.formulas)}return F}const Tt={date:"YYYY-MM-DD",month:"YYYY-MM",week:"YYYY-wo",year:"YYYY"},Nt="datePicker";var Lt={name:Nt,maker:["date","month","week"].reduce(((e,t)=>(e[t]=rt(Nt,{type:t}),e)),{dateRange:rt(Nt,{type:"range"}),datetimeRange:rt(Nt,(e=>e.props({type:"range",showTime:!0})))}),modelField:"value",mergeProp(e){const t=e.prop.props,i=t.type||t.picker;t.valueFormat||(t.valueFormat=(Tt[i]||Tt.date)+(!t.showTime||i&&"date"!==i?"":" HH:mm:ss"))},render:(e,t)=>t.$render.vNode[(!0===t.prop.props.range?"range":"date")+"Picker"](t.prop,e)};const Mt="hidden";var Ut={name:Mt,maker:{[Mt]:(e,t)=>rt(Mt)("",e,t)},render:()=>[]};const qt="input";var Ht={name:qt,maker:["password","url","email","text","textarea","search"].reduce(((e,t)=>(e[t]=rt(qt,{type:t}),e)),{idate:rt(qt,{type:"date"})}),modelField:"value",render(e,t){let i=t.prop.props.type;return-1===["textarea","search"].indexOf(i)&&(i="input"),i={textarea:"ATextarea",search:"AInputSearch"}[i]||"AInput",t.$render.vNode.make(i,t.prop,e)}},zt={name:"timePicker",modelField:"value",mergeProp(e){const t=e.prop.props;t.valueFormat||(t.valueFormat="HH:mm:ss")},render:(e,t)=>t.$render.vNode["time"+(!0===t.prop.props.range?"Range":"")+"Picker"](t.prop,e)},Gt={name:"tree",modelField:"checkedKeys",mergeProp(e){const t=e.prop.props;t.fieldNames?t.fieldNames.key||(t.fieldNames.key="id"):t.fieldNames={key:"id"},t.checkedKeys=e.rule.value,t.checkable=!0}},Jt={name:"FcRow",render:(e,t)=>t.vNode.col({props:{span:24}},{default:()=>[t.vNode.row(t.prop,e)]})};var Yt=[ge,Lt,{...Lt,name:"rangePicker",maker:{},render:(e,t)=>t.$render.vNode.rangePicker(t.prop,e)},Ut,Ht,zt,{...zt,name:"timeRangePicker",render:(e,t)=>t.$render.vNode.timeRangePicker(t.prop,e)},Gt,ye,ve,Jt];var Wt={tooltip:"aTooltip",popover:"aPopover",button:"aButton",icon:"aIcon",slider:"aSlider",rate:"aRate",upload:"fcUpload",cascader:"aCascader",timePicker:"aTimePicker",timeRangePicker:"aTimeRangePicker",datePicker:"aDatePicker",rangePicker:"aRangePicker",switch:"aSwitch",select:"aSelect",checkbox:"aCheckboxGroup",radio:"aRadioGroup",inputNumber:"aInputNumber",treeSelect:"aTreeSelect",search:"aInputSearch",inputPassword:"aInputPassword",textarea:"aTextarea",formItem:"aFormItem",form:"aForm",frame:"fcFrame",col:"aCol",row:"aRow",tree:"aTree",autoComplete:"aAutoComplete",group:"fcGroup",subForm:"fcSubForm",object:"fcSubForm"};const Kt=void 0;function Qt(e,t){ie(e,t)&&te.String(e[t])&&(e[t]={[t]:e[t],show:!0})}function Xt(e){return!1===e}function Zt(e){const t={...e};return delete t.children,t}var ei={validate(){const e=this.form();return e?e.validate():new Promise((e=>e()))},validateField(e){const t=this.form();return t?t.validateFields(e):new Promise((e=>e()))},clearValidateState(e){const t=this.vm.refs[e.wrapRef];t&&t.clearValidate()},tidyOptions:e=>(["submitBtn","resetBtn","row","info","wrap","col","title"].forEach((t=>{!function(e,t){ie(e,t)&&!te.Object(e[t])&&(e[t]={show:!!e[t]})}(e,t)})),e),tidyRule:({prop:e})=>(Qt(e,"title"),Qt(e,"info"),e),mergeProp(e){e.prop=Me([{info:this.options.info||{},wrap:this.options.wrap||{},col:this.options.col||{},title:this.options.title||{}},e.prop],{info:{type:"popover",placement:"topLeft",icon:"QuestionCircleOutlined"},title:{},col:{span:24},wrap:{}},{normal:["title","info","col","wrap"]})},getDefaultOptions:()=>({form:{hideRequiredMark:!1,layout:"horizontal",labelAlign:"right",labelCol:{span:3},wrapperCol:{span:21},validateOnRuleChange:!0},row:{gutter:0},submitBtn:{disabled:!1,loading:!1,type:"primary",innerText:"提交",show:!0,col:Kt,click:Kt},resetBtn:{disabled:!1,loading:!1,type:"default",innerText:"重置",show:!1,col:Kt,click:Kt}}),update(){const e=this.options.form;this.rule={props:{...e},on:{submit:e=>{e.preventDefault()}},class:[e.className,e.class,"form-create",this.options.preview?"is-preview":""],style:e.style,type:"form"}},beforeRender(){const{key:e,ref:t,$handle:i}=this;le(this.rule,{key:e,ref:t}),le(this.rule.props,{model:i.formData})},render(e){return e.slotLen()&&!this.options.preview&&e.setSlot(void 0,(()=>this.makeFormBtn())),this.$r(this.rule,Xt(this.options.row.show)?e.getSlots():[this.makeRow(e)])},makeWrap(e,t){const i=e.prop,r=`${this.key}${e.key}`,n=i.col,s=this.isTitle(i),{layout:o,col:a}=this.rule.props,l=Xt(i.wrap.show)?t:this.$r(Me([i.wrap,{props:{...Zt(i.wrap||{}),name:e.id,rules:i.validate,..."horizontal"!==o?{labelCol:{},wrapperCol:{}}:{}},class:i.className,key:`${r}fi`,ref:e.wrapRef,type:"formItem"}]),{default:()=>t,...s?{label:()=>this.makeInfo(i,r,e)}:{}});return"inline"===o||Xt(a)||Xt(n.show)?l:this.makeCol(i,r,[l])},isTitle(e){if(!1===this.options.form.title)return!1;const t=e.title;return!(!t.title&&!t.native||Xt(t.show))},makeInfo(e,t,i){const r={...e.title},n={...e.info};if(!1===this.options.form.title)return!1;if(!r.title&&!r.native||Xt(r.show))return;const s="tooltip"===n.type;const o=this.getSlot("title"),a=[o?o({title:r.title||"",rule:i.rule,options:this.options}):r.title];if(!Xt(n.show)&&(n.info||n.native)&&!Xt(n.icon)){const e={type:n.type||"popover",props:Zt(n),key:`${t}pop`};delete e.props.icon,delete e.props.show,delete e.props.info,delete e.props.align,delete e.props.native;const i=s?"title":"content";n.info&&!ie(e.props,i)&&(e.props[i]=n.info),a["left"!==n.align?"unshift":"push"](this.$r(Me([n,e]),{[r.slot||"default"]:()=>this.$r({type:!0===n.icon?"QuestionCircleOutlined":n.icon||"",props:{type:!0===n.icon?"QuestionCircleOutlined":n.icon},key:`${t}i`})}))}const l=Me([r,{props:Zt(r),key:`${t}tit`,type:r.type||"span"}]);return delete l.props.show,delete l.props.title,delete l.props.native,this.$r(l,a)},makeCol(e,t,i){const r=e.col;return this.$r({class:r.class,type:"col",props:r||{span:24},key:`${t}col`},i)},makeRow(e){const t=this.options.row||{};return this.$r({type:"row",props:t,class:t.class,key:`${this.key}row`},e)},makeFormBtn(){let e=[];if(Xt(this.options.submitBtn.show)||e.push(this.makeSubmitBtn()),Xt(this.options.resetBtn.show)||e.push(this.makeResetBtn()),!e.length)return;let{labelCol:t,wrapperCol:i,layout:r}=this.rule.props;"horizontal"!==r&&(t=i={});const n=this.$r({type:"formItem",key:`${this.key}fb`,props:{labelCol:t,wrapperCol:i,label:" ",colon:!1}},e);return"inline"===r?n:this.$r({type:"col",props:{span:24},key:`${this.key}fc`},[n])},makeResetBtn(){const e={...this.options.resetBtn},t=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,style:{width:e.width,marginLeft:"10px"},on:{click:()=>{const e=this.$handle.api;this.options.resetBtn.click?this.options.resetBtn.click(e):e.resetFields()}},key:`${this.key}b2`},[t])},makeSubmitBtn(){const e={...this.options.submitBtn},t=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,style:{width:e.width},on:{click:()=>{const e=this.$handle.api;this.options.submitBtn.click?this.options.submitBtn.click(e):e.submit().catch((()=>{}))}},key:`${this.key}b1`},[t])}};const ti={};!function(e){["treeSelect","upload","frame","autoComplete","cascader","datePicker","frame","inputNumber","inputPassword","radio","rate","switch","rate","slider","timePicker"].reduce(((e,t)=>(e[t]=rt(t),e)),e),e.auto=e.autoComplete,e.number=e.inputNumber,e.time=e.timePicker,e.password=e.inputPassword}(ti),function(e){e.sliderRange=rt("slider",{range:!0})}(ti),function(e){const t={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]};Object.keys(t).reduce(((e,i)=>(e[i]=rt("frame",(e=>e.props({type:t[i][0],maxLength:t[i][1]}))),e)),e),e.frameInput=e.frameInputs,e.frameFile=e.frameFiles,e.frameImage=e.frameImages}(ti),function(e){const t={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]};Object.keys(t).reduce(((e,i)=>(e[i]=rt("upload",(e=>e.props({uploadType:t[i][0],maxLength:t[i][1]}))),e)),e),e.uploadImage=e.image,e.uploadFile=e.file}(ti),function(e){const t="select";e.selectMultiple=rt(t,{mode:"multiple"}),e.selectTags=rt(t,{mode:"tags"}),e.selectCombobox=rt(t,{mode:"combobox"})}(ti);function ii(e,t){return te.Boolean(e)?e={show:e}:te.Undef(e)||te.Object(e)||(e={show:t}),e}function ri(e,t){return le(e,{formEl:()=>t.$manager.form(),wrapEl(e){const i=t.getFieldCtx(e);if(i)return t.vm.refs[i.wrapRef]},validate:i=>new Promise(((r,n)=>{const s=e.children,o=[t.$manager.validate()];s.forEach((e=>{o.push(e.validate())})),Promise.all(o).then((()=>{r(!0),i&&i(!0)})).catch((r=>{n(r),i&&i(r),t.vm.emit("validate-fail",r,{api:e})}))})),validateField:(i,r)=>new Promise(((n,s)=>{const o=t.getFieldCtx(i);if(!o)return;const a=t.subForm[o.id],l=[t.$manager.validateField(o.id)];F(a).forEach((e=>{l.push(e.validate())})),Promise.all(l).then((()=>{n(null),r&&r(null)})).catch((n=>{s(n),r&&r(n),t.vm.emit("validate-field-fail",n,{field:i,api:e})}))})),clearValidateState(i,r=!0){e.helper.tidyFields(i).forEach((e=>{r&&this.clearSubValidateState(e),t.getCtxs(e).forEach((e=>{t.$manager.clearValidateState(e)}))}))},clearSubValidateState(i){e.helper.tidyFields(i).forEach((e=>{t.getCtxs(e).forEach((e=>{const i=t.subForm[e.id];i&&(Array.isArray(i)?i.forEach((e=>{e.clearValidateState()})):i&&i.clearValidateState())}))}))},btn:{loading:(t=!0)=>{e.submitBtnProps({loading:!!t})},disabled:(t=!0)=>{e.submitBtnProps({disabled:!!t})},show:(t=!0)=>{e.submitBtnProps({show:!!t})}},resetBtn:{loading:(t=!0)=>{e.resetBtnProps({loading:!!t})},disabled:(t=!0)=>{e.resetBtnProps({disabled:!!t})},show:(t=!0)=>{e.resetBtnProps({show:!!t})}},submitBtnProps:(i={})=>{let r=ii(t.options.submitBtn,!0);le(r,i),t.options.submitBtn=r,e.refreshOptions()},resetBtnProps:(i={})=>{let r=ii(t.options.resetBtn,!1);le(r,i),t.options.resetBtn=r,e.refreshOptions()},submit:(i,r)=>new Promise(((n,s)=>{e.validate().then((()=>{let r=e.formData();te.Function(i)&&et((()=>i(r,e))),te.Function(t.options.onSubmit)&&et((()=>t.options.onSubmit(r,e))),t.vm.emit("submit",r,e),n(r)})).catch(((...t)=>{te.Function(r)&&et((()=>r(e,...t))),s(...t)}))}))}),e}X('.form-create .form-create .ant-form-item{margin-bottom:22px}.form-create .form-create .ant-form-item.ant-form-item-with-help{margin-bottom:3px}.form-create .form-create .ant-form-item .ant-form-item.ant-form-item-with-help{margin-bottom:-22px}.form-create{width:100%}.form-create .fc-none,.form-create.is-preview .fc-clock{display:none!important}.form-create.is-preview .ant-form-item .ant-form-item-label>label.ant-form-item-required:before{content:""!important}');var ni={autoComplete:"value",cascader:"value",inputNumber:"value",inputPassword:"value",rate:"value",slider:"value",treeSelect:"value",switch:"checked"};const si={name:"required",load(e,t,i){const r=function(e){return te.Boolean(e)?{required:e}:te.String(e)?{message:e}:te.Undef(e)?{required:!1}:te.Function(e)?{validator:e}:te.Object(e)?e:{}}(e.getValue());if(!1===r.required)e.clearProp(),i.clearValidateState([t.field]);else{const i={required:!0,validator:(e,t)=>new Promise(((e,r)=>{te.empty(t)?r(i.message):e()})),...r};if(!i.message){let e=t.title||"";i.message=(("object"==typeof e?e.title:e)||"")+"不能为空"}e.getProp().validate=[i]}i.sync(t)},watch(...e){si.load(...e)}};function oi(e){e.componentAlias(Wt),Object.keys(ni).forEach((t=>{e.setModelField(t,ni[t])})),me.forEach((t=>{e.component(t.name,t)})),e.register(si),Yt.forEach((t=>{e.parser(t)})),Object.keys(ti).forEach((t=>{e.maker[t]=ti[t]})),"undefined"!=typeof window&&window.antd&&e.useApp(((e,t)=>{t.use(window.antd)}))}const ai=Dt({ui:"ant-design-vue",version:"3.1.32",manager:ei,install:oi,extendApi:ri,attrs:{normal:["col","wrap"],array:["className"],key:["title","info"]}});"undefined"!=typeof window&&(window.formCreate=ai);const li=ai.maker;export{ai as default,li as maker};
